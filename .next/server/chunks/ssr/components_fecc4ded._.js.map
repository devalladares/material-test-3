{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/utils/canvasUtils.js"],"sourcesContent":["// Get the correct coordinates based on canvas scaling\nexport const getCoordinates = (e, canvas) => {\n  const rect = canvas.getBoundingClientRect();\n  \n  // Calculate the scaling factor between the internal canvas size and displayed size\n  const scaleX = canvas.width / rect.width;\n  const scaleY = canvas.height / rect.height;\n  \n  // Apply the scaling to get accurate coordinates\n  return {\n    x: (e.nativeEvent.offsetX || (e.nativeEvent.touches?.[0]?.clientX - rect.left)) * scaleX,\n    y: (e.nativeEvent.offsetY || (e.nativeEvent.touches?.[0]?.clientY - rect.top)) * scaleY\n  };\n};\n\n// Initialize canvas with white background\nexport const initializeCanvas = (canvas) => {\n  const ctx = canvas.getContext(\"2d\");\n  \n  // Fill canvas with white background\n  ctx.fillStyle = \"#FFFFFF\";\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n};\n\n// Draw the background image to the canvas\nexport const drawImageToCanvas = (canvas, backgroundImage) => {\n  if (!canvas || !backgroundImage) return;\n  \n  const ctx = canvas.getContext(\"2d\");\n  \n  // Fill with white background first\n  ctx.fillStyle = \"#FFFFFF\";\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  \n  // Draw the background image\n  ctx.drawImage(\n    backgroundImage,\n    0, 0,\n    canvas.width, canvas.height\n  );\n};\n\n// Draw bezier curve\nexport const drawBezierCurve = (canvas, points) => {\n  const ctx = canvas.getContext('2d');\n  \n  if (!points || points.length < 2) {\n    console.error('Need at least 2 points to draw a path');\n    return;\n  }\n  \n  ctx.beginPath();\n  ctx.strokeStyle = '#000000';\n  ctx.lineWidth = 4;\n  \n  // Start at the first anchor point\n  ctx.moveTo(points[0].x, points[0].y);\n  \n  // For each pair of anchor points (and their control points)\n  for (let i = 0; i < points.length - 1; i++) {\n    const current = points[i];\n    const next = points[i + 1];\n    \n    if (current.handleOut && next.handleIn) {\n      // If both points have handles, draw a cubic bezier\n      ctx.bezierCurveTo(\n        current.x + (current.handleOut?.x || 0), current.y + (current.handleOut?.y || 0),\n        next.x + (next.handleIn?.x || 0), next.y + (next.handleIn?.y || 0),\n        next.x, next.y\n      );\n    } else {\n      // If no handles, draw a straight line\n      ctx.lineTo(next.x, next.y);\n    }\n  }\n  \n  ctx.stroke();\n};\n\n// Draw bezier guides (control points and lines)\nexport const drawBezierGuides = (ctx, points) => {\n  if (!points || points.length === 0) return;\n  \n  // Draw the path itself first (as a light preview)\n  ctx.save();\n  ctx.globalAlpha = 0.3;\n  ctx.strokeStyle = '#888888';\n  ctx.lineWidth = 1.5;\n  \n  ctx.beginPath();\n  ctx.moveTo(points[0].x, points[0].y);\n  \n  // For each pair of anchor points (and their control points)\n  for (let i = 0; i < points.length - 1; i++) {\n    const current = points[i];\n    const next = points[i + 1];\n    \n    if (current.handleOut && next.handleIn) {\n      // If both points have handles, draw a cubic bezier\n      ctx.bezierCurveTo(\n        current.x + (current.handleOut?.x || 0), current.y + (current.handleOut?.y || 0),\n        next.x + (next.handleIn?.x || 0), next.y + (next.handleIn?.y || 0),\n        next.x, next.y\n      );\n    } else {\n      // If no handles, draw a straight line\n      ctx.lineTo(next.x, next.y);\n    }\n  }\n  \n  ctx.stroke();\n  ctx.restore();\n  \n  // Draw guide lines between anchor points and their handles\n  ctx.strokeStyle = 'rgba(100, 100, 255, 0.5)';\n  ctx.lineWidth = 1;\n  \n  for (const point of points) {\n    // Draw line from anchor to in-handle if it exists\n    if (point.handleIn) {\n      ctx.beginPath();\n      ctx.moveTo(point.x, point.y);\n      ctx.lineTo(point.x + point.handleIn.x, point.y + point.handleIn.y);\n      ctx.stroke();\n    }\n    \n    // Draw line from anchor to out-handle if it exists\n    if (point.handleOut) {\n      ctx.beginPath();\n      ctx.moveTo(point.x, point.y);\n      ctx.lineTo(point.x + point.handleOut.x, point.y + point.handleOut.y);\n      ctx.stroke();\n    }\n  }\n  \n  // Draw anchor points (main points of the path)\n  for (const point of points) {\n    // Draw the main anchor point\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';\n    ctx.lineWidth = 1;\n    \n    ctx.beginPath();\n    ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.stroke();\n    \n    // Draw the handle points if they exist\n    if (point.handleIn) {\n      ctx.fillStyle = 'rgba(100, 100, 255, 0.8)';\n      ctx.beginPath();\n      ctx.arc(point.x + point.handleIn.x, point.y + point.handleIn.y, 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    \n    if (point.handleOut) {\n      ctx.fillStyle = 'rgba(100, 100, 255, 0.8)';\n      ctx.beginPath();\n      ctx.arc(point.x + point.handleOut.x, point.y + point.handleOut.y, 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n  }\n};\n\n// Helper to create a new anchor point with handles\nexport const createAnchorPoint = (x, y, prevPoint = null) => {\n  // By default, create a point with no handles\n  const point = { x, y, handleIn: null, handleOut: null };\n  \n  // If there's a previous point, automatically add symmetric handles\n  if (prevPoint) {\n    // Calculate the default handle length (as a percentage of distance to previous point)\n    const dx = x - prevPoint.x;\n    const dy = y - prevPoint.y;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    const handleLength = distance * 0.3; // 30% of distance between points\n    \n    // Create handles perpendicular to the line between points\n    // For a smooth curve, make the previous point's out handle opposite to this point's in handle\n    const angle = Math.atan2(dy, dx);\n    \n    // Add an out handle to the previous point (if it doesn't already have one)\n    if (!prevPoint.handleOut) {\n      prevPoint.handleOut = {\n        x: Math.cos(angle) * -handleLength,\n        y: Math.sin(angle) * -handleLength\n      };\n    }\n    \n    // Add an in handle to the current point\n    point.handleIn = {\n      x: Math.cos(angle) * -handleLength,\n      y: Math.sin(angle) * -handleLength\n    };\n  }\n  \n  return point;\n};\n\n// Helper to check if a point is near a handle\nexport const isNearHandle = (point, handleType, x, y, radius = 10) => {\n  if (!point || !point[handleType]) return false;\n  \n  const handleX = point.x + point[handleType].x;\n  const handleY = point.y + point[handleType].y;\n  \n  const dx = handleX - x;\n  const dy = handleY - y;\n  \n  return (dx * dx + dy * dy) <= radius * radius;\n};\n\n// Helper to update a handle position\nexport const updateHandle = (point, handleType, dx, dy, symmetric = true) => {\n  if (!point || !point[handleType]) return;\n  \n  // Update the target handle\n  point[handleType].x += dx;\n  point[handleType].y += dy;\n  \n  // If symmetric and the other handle exists, update it to be symmetrical\n  if (symmetric) {\n    const otherType = handleType === 'handleIn' ? 'handleOut' : 'handleIn';\n    \n    if (point[otherType]) {\n      point[otherType].x = -point[handleType].x;\n      point[otherType].y = -point[handleType].y;\n    }\n  }\n}; "],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/ToolBar.js"],"sourcesContent":["import { Pencil, Eraser, Type, Undo, Trash2, PenLine } from 'lucide-react';\nimport { PenTool } from 'lucide-react';\nimport { Undo2 } from 'lucide-react';\nimport { useState } from 'react';\n\nconst ToolBar = ({ \n  currentTool, \n  setCurrentTool, \n  handleUndo, \n  clearCanvas, \n  orientation = 'horizontal',\n  currentWidth,\n  setStrokeWidth\n}) => {\n  const mainTools = [\n    { id: 'pencil', icon: Pencil, label: 'Pencil' },\n    { id: 'pen', icon: PenTool, label: 'Pen' },\n    { id: 'eraser', icon: Eraser, label: 'Eraser' },\n    { id: 'text', icon: Type, label: 'Text' }\n  ];\n\n  const actions = [\n    { id: 'undo', icon: Undo2, label: 'Undo', onClick: handleUndo },\n    { id: 'clear', icon: Trash2, label: 'Clear', onClick: clearCanvas }\n  ];\n\n  const containerClasses = orientation === 'vertical' \n    ? 'flex flex-col gap-2 bg-white rounded-xl shadow-soft p-2 border border-gray-200'\n    : 'flex gap-2 bg-white rounded-xl shadow-soft p-2 border border-gray-200';\n\n  return (\n    <div className={containerClasses}>\n      {mainTools.map((tool) => (\n        <div key={tool.id} className=\"relative\">\n          <button\n            onClick={() => setCurrentTool(tool.id)}\n            className={`p-2 rounded-lg transition-colors ${\n              currentTool === tool.id\n                ? 'bg-gray-100 text-gray-900'\n                : 'text-gray-600 hover:bg-gray-50'\n            }`}\n            title={tool.label}\n          >\n            <tool.icon className=\"w-5 h-5\" />\n          </button>\n        </div>\n      ))}\n      \n      {orientation === 'vertical' && <div className=\"h-px bg-gray-200 my-2\" />}\n      {orientation === 'horizontal' && <div className=\"w-px bg-gray-200 mx-2\" />}\n      \n      {actions.map((action) => (\n        <button\n          key={action.id}\n          onClick={action.onClick}\n          className=\"p-2 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors\"\n          title={action.label}\n        >\n          <action.icon className=\"w-5 h-5\" />\n        </button>\n      ))}\n    </div>\n  );\n};\n\nexport default ToolBar; "],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,UAAU,CAAC,EACf,WAAW,EACX,cAAc,EACd,UAAU,EACV,WAAW,EACX,cAAc,YAAY,EAC1B,YAAY,EACZ,cAAc,EACf;IACC,MAAM,YAAY;QAChB;YAAE,IAAI;YAAU,MAAM,+LAAA,CAAA,SAAM;YAAE,OAAO;QAAS;QAC9C;YAAE,IAAI;YAAO,MAAM,qMAAA,CAAA,UAAO;YAAE,OAAO;QAAM;QACzC;YAAE,IAAI;YAAU,MAAM,+LAAA,CAAA,SAAM;YAAE,OAAO;QAAS;QAC9C;YAAE,IAAI;YAAQ,MAAM,2LAAA,CAAA,OAAI;YAAE,OAAO;QAAO;KACzC;IAED,MAAM,UAAU;QACd;YAAE,IAAI;YAAQ,MAAM,iMAAA,CAAA,QAAK;YAAE,OAAO;YAAQ,SAAS;QAAW;QAC9D;YAAE,IAAI;YAAS,MAAM,mMAAA,CAAA,SAAM;YAAE,OAAO;YAAS,SAAS;QAAY;KACnE;IAED,MAAM,mBAAmB,gBAAgB,aACrC,mFACA;IAEJ,qBACE,qKAAC;QAAI,WAAW;;YACb,UAAU,GAAG,CAAC,CAAC,qBACd,qKAAC;oBAAkB,WAAU;8BAC3B,cAAA,qKAAC;wBACC,SAAS,IAAM,eAAe,KAAK,EAAE;wBACrC,WAAW,CAAC,iCAAiC,EAC3C,gBAAgB,KAAK,EAAE,GACnB,8BACA,kCACJ;wBACF,OAAO,KAAK,KAAK;kCAEjB,cAAA,qKAAC,KAAK,IAAI;4BAAC,WAAU;;;;;;;;;;;mBAVf,KAAK,EAAE;;;;;YAelB,gBAAgB,4BAAc,qKAAC;gBAAI,WAAU;;;;;;YAC7C,gBAAgB,8BAAgB,qKAAC;gBAAI,WAAU;;;;;;YAE/C,QAAQ,GAAG,CAAC,CAAC,uBACZ,qKAAC;oBAEC,SAAS,OAAO,OAAO;oBACvB,WAAU;oBACV,OAAO,OAAO,KAAK;8BAEnB,cAAA,qKAAC,OAAO,IAAI;wBAAC,WAAU;;;;;;mBALlB,OAAO,EAAE;;;;;;;;;;;AAUxB;uCAEe","debugId":null}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/Canvas.js"],"sourcesContent":["import { useRef, useEffect, useState, forwardRef } from 'react';\nimport { \n  getCoordinates, \n  drawBezierCurve, \n  drawBezierGuides, \n  createAnchorPoint,\n  isNearHandle,\n  updateHandle\n} from './utils/canvasUtils';\nimport { PencilLine, Upload, ImagePlus, LoaderCircle } from 'lucide-react';\nimport ToolBar from './ToolBar';\n\nconst Canvas = forwardRef(({\n  canvasRef,\n  currentTool,\n  isDrawing,\n  startDrawing,\n  draw,\n  stopDrawing,\n  handleCanvasClick,\n  handlePenClick,\n  handleGeneration,\n  tempPoints,\n  setTempPoints,\n  handleUndo,\n  clearCanvas,\n  setCurrentTool,\n  currentDimension,\n  onImageUpload,\n  onGenerate,\n  isGenerating,\n  setIsGenerating,\n  currentColor,\n  currentWidth,\n  handleStrokeWidth,\n  saveCanvasState,\n  onDrawingChange,\n}, ref) => {\n  const [showBezierGuides, setShowBezierGuides] = useState(true);\n  const [activePoint, setActivePoint] = useState(-1);\n  const [activeHandle, setActiveHandle] = useState(null);\n  const [symmetric, setSymmetric] = useState(true);\n  const [lastMousePos, setLastMousePos] = useState({ x: 0, y: 0 });\n  const [hasDrawing, setHasDrawing] = useState(false);\n  const [strokeCount, setStrokeCount] = useState(0);\n  const fileInputRef = useRef(null);\n  const [shapeStartPos, setShapeStartPos] = useState(null);\n  const [previewCanvas, setPreviewCanvas] = useState(null);\n  const [isDoodleConverting, setIsDoodleConverting] = useState(false);\n\n  // Add touch event prevention function\n  useEffect(() => {\n    // Function to prevent default touch behavior on canvas\n    const preventTouchDefault = (e) => {\n      if (isDrawing) {\n        e.preventDefault();\n      }\n    };\n\n    // Add event listener when component mounts\n    const canvas = canvasRef.current;\n    if (canvas) {\n      canvas.addEventListener('touchstart', preventTouchDefault, { passive: false });\n      canvas.addEventListener('touchmove', preventTouchDefault, { passive: false });\n    }\n\n    // Remove event listener when component unmounts\n    return () => {\n      if (canvas) {\n        canvas.removeEventListener('touchstart', preventTouchDefault);\n        canvas.removeEventListener('touchmove', preventTouchDefault);\n      }\n    };\n  }, [isDrawing, canvasRef]);\n\n  // Add debugging info to console\n  useEffect(() => {\n    console.log('Canvas tool changed or isDrawing changed:', { currentTool, isDrawing });\n  }, [currentTool, isDrawing]);\n\n  // Redraw bezier guides and control points when tempPoints change\n  useEffect(() => {\n    if (currentTool === 'pen' && tempPoints.length > 0 && showBezierGuides) {\n      redrawBezierGuides();\n    }\n  }, [tempPoints, showBezierGuides, currentTool]);\n\n  // Add useEffect to check if canvas has content\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    const ctx = canvas.getContext('2d');\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    \n    // Check if canvas has any non-white pixels (i.e., has a drawing)\n    const hasNonWhitePixels = Array.from(imageData.data).some((pixel, index) => {\n      // Check only RGB values (skip alpha)\n      return index % 4 !== 3 && pixel !== 255;\n    });\n    \n    setHasDrawing(hasNonWhitePixels);\n  }, [canvasRef]);\n\n  const handleKeyDown = (e) => {\n    // Add keyboard accessibility\n    if (e.key === 'Enter' || e.key === ' ') {\n      handleCanvasClick(e);\n    }\n    \n    // Toggle symmetric handles with Shift key\n    if (e.key === 'Shift') {\n      setSymmetric(!symmetric);\n    }\n  };\n\n  // Draw bezier control points and guide lines\n  const redrawBezierGuides = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    // Get the canvas context\n    const ctx = canvas.getContext('2d');\n    \n    // Save the current canvas state to redraw later\n    const canvasImage = new Image();\n    canvasImage.src = canvas.toDataURL();\n    \n    canvasImage.onload = () => {\n      // Clear canvas\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      \n      // Redraw the canvas content\n      ctx.drawImage(canvasImage, 0, 0);\n      \n      // Draw the control points and guide lines\n      drawBezierGuides(ctx, tempPoints);\n    };\n  };\n\n  // Function to draw a star shape\n  const drawStar = (ctx, x, y, radius, points = 5) => {\n    ctx.beginPath();\n    for (let i = 0; i <= points * 2; i++) {\n      const r = i % 2 === 0 ? radius : radius / 2;\n      const angle = (i * Math.PI) / points;\n      const xPos = x + r * Math.sin(angle);\n      const yPos = y + r * Math.cos(angle);\n      if (i === 0) ctx.moveTo(xPos, yPos);\n      else ctx.lineTo(xPos, yPos);\n    }\n    ctx.closePath();\n  };\n\n  // Function to draw shapes\n  const drawShape = (ctx, startPos, endPos, shape, isPreview = false) => {\n    if (!startPos || !endPos) return;\n\n    const width = endPos.x - startPos.x;\n    const height = endPos.y - startPos.y;\n    const radius = Math.sqrt(width * width + height * height) / 2;\n\n    ctx.strokeStyle = currentColor || '#000000';\n    ctx.fillStyle = currentColor || '#000000';\n    ctx.lineWidth = currentWidth || 2;\n\n    switch (shape) {\n      case 'rect':\n        if (isPreview) {\n          ctx.strokeRect(startPos.x, startPos.y, width, height);\n        } else {\n          ctx.fillRect(startPos.x, startPos.y, width, height);\n        }\n        break;\n      case 'circle':\n        ctx.beginPath();\n        ctx.ellipse(\n          startPos.x + width / 2,\n          startPos.y + height / 2,\n          Math.abs(width / 2),\n          Math.abs(height / 2),\n          0,\n          0,\n          2 * Math.PI\n        );\n        if (isPreview) {\n          ctx.stroke();\n        } else {\n          ctx.fill();\n        }\n        break;\n      case 'line':\n        ctx.beginPath();\n        ctx.lineCap = 'round';\n        ctx.lineWidth = currentWidth * 2 || 4; // Make lines thicker\n        ctx.moveTo(startPos.x, startPos.y);\n        ctx.lineTo(endPos.x, endPos.y);\n        ctx.stroke();\n        break;\n      case 'star':\n        const centerX = startPos.x + width / 2;\n        const centerY = startPos.y + height / 2;\n        drawStar(ctx, centerX, centerY, radius);\n        if (isPreview) {\n          ctx.stroke();\n        } else {\n          ctx.fill();\n        }\n        break;\n    }\n  };\n\n  // Modified startDrawing handler\n  const handleStartDrawing = (e) => {\n    console.log('Canvas onMouseDown', { currentTool, isDrawing });\n    \n    if (currentTool === 'pen') {\n      if (!checkForPointOrHandle(e)) {\n        handlePenToolClick(e);\n      }\n      return;\n    }\n    \n    const { x, y } = getCoordinates(e, canvasRef.current);\n    \n    if (['rect', 'circle', 'line', 'star'].includes(currentTool)) {\n      setShapeStartPos({ x, y });\n      \n      // Create preview canvas if it doesn't exist\n      if (!previewCanvas) {\n        const canvas = document.createElement('canvas');\n        canvas.width = canvasRef.current.width;\n        canvas.height = canvasRef.current.height;\n        setPreviewCanvas(canvas);\n      }\n    }\n    \n    startDrawing(e);\n    setHasDrawing(true);\n  };\n\n  // Modified draw handler\n  const handleDraw = (e) => {\n    if (currentTool === 'pen' && handleBezierMouseMove(e)) {\n      return;\n    }\n\n    if (!isDrawing) return;\n    \n    const canvas = canvasRef.current;\n    const { x, y } = getCoordinates(e, canvas);\n    \n    draw(e);\n  };\n\n  // Modified stopDrawing handler\n  const handleStopDrawing = (e) => {\n    console.log('handleStopDrawing called', { \n      eventType: e?.type, \n      currentTool, \n      isDrawing, \n      activePoint, \n      activeHandle\n    });\n    \n    // If we're using the pen tool with active point or handle\n    if (currentTool === 'pen') {\n      // If we were dragging a handle, just release it\n      if (activeHandle) {\n        setActiveHandle(null);\n        return;\n      }\n      \n      // If we were dragging an anchor point, just release it\n      if (activePoint !== -1) {\n        setActivePoint(-1);\n        return;\n      }\n    }\n\n    stopDrawing(e);\n\n    // If using the pencil tool and we've just finished a drag, trigger generation\n    if (currentTool === 'pencil' && isDrawing) {\n      console.log(`${currentTool} tool condition met, will try to trigger generation`);\n      \n      // Small delay to ensure the drawing is complete\n      setTimeout(() => {\n        console.log('Attempting to call handleGeneration after timeout');\n        if (typeof handleGeneration === 'function') {\n          console.log('Calling handleGeneration function');\n          handleGeneration();\n        } else {\n          console.error('handleGeneration is not a function:', handleGeneration);\n        }\n      }, 100);\n    } else {\n      console.log('Generation not triggered because:', { \n        isPencilTool: currentTool === 'pencil',\n        wasDrawing: isDrawing \n      });\n    }\n  };\n\n  // Check if we clicked on an existing point or handle\n  const checkForPointOrHandle = (e) => {\n    if (currentTool !== 'pen' || !showBezierGuides || tempPoints.length === 0) {\n      return false;\n    }\n    \n    const canvas = canvasRef.current;\n    const { x, y } = getCoordinates(e, canvas);\n    setLastMousePos({ x, y });\n    \n    // Check if we clicked on a handle\n    for (let i = 0; i < tempPoints.length; i++) {\n      const point = tempPoints[i];\n      \n      // Check for handleIn\n      if (isNearHandle(point, 'handleIn', x, y)) {\n        setActivePoint(i);\n        setActiveHandle('handleIn');\n        return true;\n      }\n      \n      // Check for handleOut\n      if (isNearHandle(point, 'handleOut', x, y)) {\n        setActivePoint(i);\n        setActiveHandle('handleOut');\n        return true;\n      }\n      \n      // Check for the anchor point itself\n      const distance = Math.sqrt((point.x - x) ** 2 + (point.y - y) ** 2);\n      if (distance <= 10) {\n        setActivePoint(i);\n        setActiveHandle(null);\n        return true;\n      }\n    }\n    \n    return false;\n  };\n  \n  // Handle mouse move for bezier control point or handle dragging\n  const handleBezierMouseMove = (e) => {\n    if (currentTool !== 'pen') {\n      return false;\n    }\n    \n    const canvas = canvasRef.current;\n    const { x, y } = getCoordinates(e, canvas);\n    const dx = x - lastMousePos.x;\n    const dy = y - lastMousePos.y;\n    \n    // If we're dragging a handle\n    if (activePoint !== -1 && activeHandle) {\n      const newPoints = [...tempPoints];\n      updateHandle(newPoints[activePoint], activeHandle, dx, dy, symmetric);\n      setTempPoints(newPoints);\n      setLastMousePos({ x, y });\n      return true;\n    }\n    \n    // If we're dragging an anchor point\n    if (activePoint !== -1) {\n      const newPoints = [...tempPoints];\n      newPoints[activePoint].x += dx;\n      newPoints[activePoint].y += dy;\n      \n      // If this point has handles, move them with the point\n      if (newPoints[activePoint].handleIn) {\n        // No need to change the handle's offset, just move with the point\n      }\n      \n      if (newPoints[activePoint].handleOut) {\n        // No need to change the handle's offset, just move with the point\n      }\n      \n      setTempPoints(newPoints);\n      setLastMousePos({ x, y });\n      return true;\n    }\n    \n    return false;\n  };\n\n  // Handle clicks for bezier curve tool\n  const handlePenToolClick = (e) => {\n    const canvas = canvasRef.current;\n    const { x, y } = getCoordinates(e, canvas);\n    \n    // Add a new point\n    if (tempPoints.length === 0) {\n      // First point has no handles initially\n      const newPoint = { x, y, handleIn: null, handleOut: null };\n      setTempPoints([newPoint]);\n    } else {\n      // Create a new point with handles relative to the last point\n      const newPoint = createAnchorPoint(x, y, tempPoints[tempPoints.length - 1]);\n      setTempPoints([...tempPoints, newPoint]);\n    }\n    \n    // Always show guides when adding points\n    setShowBezierGuides(true);\n  };\n  \n  // Toggle bezier guide visibility\n  const toggleBezierGuides = () => {\n    setShowBezierGuides(!showBezierGuides);\n    if (showBezierGuides) {\n      redrawBezierGuides();\n    }\n  };\n\n  // Draw the final bezier curve and clear control points\n  const finalizeBezierCurve = () => {\n    if (tempPoints.length < 2) {\n      // Need at least 2 points for a path\n      console.log('Need at least 2 control points to draw a path');\n      return;\n    }\n    \n    const canvas = canvasRef.current;\n    \n    // Draw the actual bezier curve\n    drawBezierCurve(canvas, tempPoints);\n    \n    // Hide guides and reset control points\n    setShowBezierGuides(false);\n    setTempPoints([]);\n    \n    // Trigger generation\n    setTimeout(() => {\n      if (typeof handleGeneration === 'function') {\n        handleGeneration();\n      }\n    }, 100);\n  };\n\n  // Add control point to segment\n  const addControlPoint = (e) => {\n    if (currentTool !== 'pen' || tempPoints.length < 2) return;\n    \n    const canvas = canvasRef.current;\n    const { x, y } = getCoordinates(e, canvas);\n    \n    // Find the closest segment to add a point to\n    let closestDistance = Number.POSITIVE_INFINITY;\n    let insertIndex = -1;\n    \n    for (let i = 0; i < tempPoints.length - 1; i++) {\n      const p1 = tempPoints[i];\n      const p2 = tempPoints[i + 1];\n      \n      // Calculate distance from click to line between points\n      // This is a simplified distance calculation for demo purposes\n      const lineLength = Math.sqrt((p2.x - p1.x) ** 2 + (p2.y - p1.y) ** 2);\n      if (lineLength === 0) continue;\n      \n      // Project point onto line\n      const t = ((x - p1.x) * (p2.x - p1.x) + (y - p1.y) * (p2.y - p1.y)) / (lineLength * lineLength);\n      \n      // If projection is outside the line segment, skip\n      if (t < 0 || t > 1) continue;\n      \n      // Calculate closest point on line\n      const closestX = p1.x + t * (p2.x - p1.x);\n      const closestY = p1.y + t * (p2.y - p1.y);\n      \n      // Calculate distance to closest point\n      const distance = Math.sqrt((x - closestX) ** 2 + (y - closestY) ** 2);\n      \n      if (distance < closestDistance && distance < 20) {\n        closestDistance = distance;\n        insertIndex = i + 1;\n      }\n    }\n    \n    if (insertIndex > 0) {\n      // Create a new array with the new point inserted\n      const newPoints = [...tempPoints];\n      const prevPoint = newPoints[insertIndex - 1];\n      const nextPoint = newPoints[insertIndex];\n      \n      // Create a new point at the click position with automatically calculated handles\n      const newPoint = { \n        x, \n        y,\n        // Calculate handles based on the positions of adjacent points\n        handleIn: { \n          x: (prevPoint.x - x) * 0.25, \n          y: (prevPoint.y - y) * 0.25 \n        },\n        handleOut: { \n          x: (nextPoint.x - x) * 0.25, \n          y: (nextPoint.y - y) * 0.25 \n        }\n      };\n      \n      // Insert the new point\n      newPoints.splice(insertIndex, 0, newPoint);\n      setTempPoints(newPoints);\n    }\n  };\n\n  // Add function to handle image upload\n  const handleImageUpload = async (imageDataUrl) => {\n    console.log(\"handleImageUpload called with image data\");\n    const canvas = canvasRef.current;\n    if (!canvas) {\n      console.error(\"Canvas ref is null\");\n      return;\n    }\n\n    // Set hasDrawing to true immediately\n    setHasDrawing(true);\n    if (typeof onDrawingChange === 'function') {\n      onDrawingChange(true);\n    }\n\n    // First, let's convert to doodle\n    try {\n      console.log(\"Setting loading state...\");\n      setIsDoodleConverting(true);\n\n      console.log(\"Making API call to convert to doodle...\");\n      const response = await fetch('/api/generate', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          prompt: \"can you convert this into a detailed black and white doodle <3\\ndo not add or change this! follow it. just see that a black line was drawing this on a white background :)\\nPlease add as much detail as you can. Include texture details, shading elements, and fine features from the original.\",\n          drawingData: imageDataUrl.split(\",\")[1], // Make sure we're only sending the base64 data\n        }),\n      });\n\n      console.log(\"API response received\");\n      const data = await response.json();\n      console.log(\"Response data:\", data);\n      \n      if (data.success && data.imageData) {\n        console.log(\"Valid image data received, creating image...\");\n        // Draw the doodle version to the canvas\n        const img = new Image();\n        img.onload = () => {\n          console.log(\"Image loaded, drawing to canvas...\");\n          const ctx = canvas.getContext('2d');\n          \n          // Clear canvas\n          ctx.fillStyle = '#FFFFFF';\n          ctx.fillRect(0, 0, canvas.width, canvas.height);\n          \n          // Calculate dimensions\n          const scale = Math.min(\n            canvas.width / img.width,\n            canvas.height / img.height\n          );\n          const x = (canvas.width - img.width * scale) / 2;\n          const y = (canvas.height - img.height * scale) / 2;\n          \n          // Draw doodle\n          ctx.drawImage(img, x, y, img.width * scale, img.height * scale);\n          \n          // Set hasDrawing to true since we now have content\n          if (typeof onDrawingChange === 'function') {\n            onDrawingChange(true);\n          }\n          \n          // Save canvas state\n          saveCanvasState();\n          \n          // Automatically trigger 3D generation after a short delay\n          console.log(\"Setting timeout for automatic generation...\");\n          setTimeout(() => {\n            console.log(\"Timeout expired, calling handleGeneration...\");\n            if (typeof handleGeneration === 'function') {\n              setIsGenerating(true);\n              handleGeneration();\n            }\n          }, 1000);\n        };\n        \n        img.src = `data:image/png;base64,${data.imageData}`;\n      } else {\n        console.error(\"Invalid response data:\", data);\n      }\n    } catch (error) {\n      console.error('Error converting image to doodle:', error);\n    } finally {\n      console.log(\"Setting loading state to false\");\n      setIsDoodleConverting(false);\n    }\n  };\n\n  const handleGenerate = () => {\n    const canvas = canvasRef.current;\n    const imageData = canvas.toDataURL('image/png');\n    onGenerate(imageData);\n  };\n\n  const handleUploadClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    \n    // Clear \"Draw Here\" message right away\n    if (typeof onDrawingChange === 'function') {\n      onDrawingChange(true);\n    }\n    // Also update local state immediately\n    setHasDrawing(true);\n    \n    const reader = new FileReader();\n    reader.onload = async (event) => {\n      // Set loading state for doodle conversion only\n      setIsDoodleConverting(true); // Set this to true instead of the general isGenerating\n      \n      try {\n        const imageData = event.target.result.split(',')[1]; // Get base64 data without prefix\n        \n        console.log(\"Sending image for doodle conversion...\");\n        \n        // Call the new API endpoint to convert to doodle\n        const response = await fetch(\"/api/convert-to-doodle\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({ \n            imageData,\n            customApiKey: window.localStorage.getItem('gemini_api_key') // Use stored API key if available\n          }),\n        });\n        \n        if (!response.ok) {\n          throw new Error(`API returned ${response.status}`);\n        }\n        \n        const data = await response.json();\n        \n        if (data.success && data.imageData) {\n          console.log(\"Doodle conversion successful, rendering to canvas...\");\n          \n          const canvas = canvasRef.current;\n          const img = new Image();\n          img.onload = () => {\n            console.log(\"Image loaded, drawing to canvas...\");\n            const ctx = canvas.getContext('2d');\n            \n            // Clear canvas\n            ctx.fillStyle = '#FFFFFF';\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n            \n            // Calculate dimensions\n            const scale = Math.min(\n              canvas.width / img.width,\n              canvas.height / img.height\n            );\n            const x = (canvas.width - img.width * scale) / 2;\n            const y = (canvas.height - img.height * scale) / 2;\n            \n            // Draw doodle\n            ctx.drawImage(img, x, y, img.width * scale, img.height * scale);\n            \n            // Set hasDrawing to true since we now have content\n            if (typeof onDrawingChange === 'function') {\n              onDrawingChange(true);\n            }\n            \n            // Save canvas state\n            saveCanvasState();\n            \n            // Automatically trigger 3D generation after a short delay\n            console.log(\"Setting timeout for automatic generation...\");\n            setTimeout(() => {\n              console.log(\"Timeout expired, calling handleGeneration...\");\n              if (typeof handleGeneration === 'function') {\n                setIsGenerating(true);\n                handleGeneration();\n              }\n            }, 1000);\n          };\n          \n          img.src = `data:image/png;base64,${data.imageData}`;\n        } else {\n          console.error(\"Invalid response data:\", data);\n        }\n      } catch (error) {\n        console.error('Error converting image to doodle:', error);\n      } finally {\n        console.log(\"Setting doodle converting state to false\");\n        setIsDoodleConverting(false); // Only reset the doodle conversion state\n      }\n    };\n    reader.readAsDataURL(file);\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-full\">\n      <div className=\"flex gap-4\">\n        <div className=\"flex-shrink-0\">\n          <ToolBar\n            currentTool={currentTool}\n            setCurrentTool={setCurrentTool}\n            handleUndo={handleUndo}\n            clearCanvas={clearCanvas}\n            orientation=\"vertical\"\n            currentWidth={currentWidth}\n            setStrokeWidth={handleStrokeWidth}\n          />\n        </div>\n\n        <div className=\"relative w-full flex justify-center\">\n          {currentTool === 'pen' && tempPoints.length > 0 && (\n            <button\n              onClick={finalizeBezierCurve}\n              className=\"absolute top-4 right-4 z-10 bg-gray-200 text-gray-700 rounded-full px-4 py-2 flex items-center hover:bg-gray-300 transition-colors\"\n            >\n              <span className=\"mr-2 text-sm font-medium\">Draw Curve</span>\n              <PencilLine className=\"w-4 h-4\" />\n            </button>\n          )}\n\n          <div className=\"relative w-full\">\n            <canvas\n              ref={canvasRef}\n              width={currentDimension.width}\n              height={currentDimension.height}\n              className=\"border border-gray-300 bg-white rounded-xl shadow-soft\"\n              style={{\n                aspectRatio: `${currentDimension.width} / ${currentDimension.height}`,\n                maxWidth: '100%',\n                maxHeight: '800px',\n                width: '100%',\n                height: 'auto',\n                touchAction: 'none'\n              }}\n              onMouseDown={handleStartDrawing}\n              onMouseMove={handleDraw}\n              onMouseUp={handleStopDrawing}\n              onMouseLeave={handleStopDrawing}\n              onTouchStart={handleStartDrawing}\n              onTouchMove={handleDraw}\n              onTouchEnd={handleStopDrawing}\n              onClick={handleCanvasClick}\n              onKeyDown={handleKeyDown}\n              tabIndex=\"0\"\n              aria-label=\"Drawing canvas\"\n            />\n            \n            {/* Floating upload button */}\n            <button \n              onClick={handleUploadClick}\n              className=\"absolute bottom-4 right-4 z-10 bg-white border border-gray-200 text-gray-700 rounded-lg p-3 flex items-center justify-center shadow-soft hover:bg-gray-100 transition-colors\"\n              aria-label=\"Upload image\"\n              title=\"Upload image\"\n            >\n              <ImagePlus className=\"w-5 h-5\" />\n              <input \n                type=\"file\" \n                ref={fileInputRef} \n                onChange={handleFileChange} \n                className=\"hidden\" \n                accept=\"image/*\"\n              />\n            </button>\n            \n            {/* Doodle conversion loading overlay - Position on top of canvas */}\n            {isDoodleConverting && (\n              <div className=\"absolute inset-0 flex flex-col items-center justify-center bg-white/80 rounded-xl z-50\">\n                <div className=\"bg-white shadow-lg rounded-xl p-6 flex flex-col items-center\">\n                  <LoaderCircle className=\"w-12 h-12 text-gray-700 animate-spin mb-4\" />\n                  <p className=\"text-gray-900 font-medium text-lg\">Converting to doodle...</p>\n                  <p className=\"text-gray-500 text-sm mt-2\">This may take a moment</p>\n                </div>\n              </div>\n            )}\n            \n            {/* Draw here placeholder - only show when canvas is empty */}\n            {!hasDrawing && !isDoodleConverting && (\n              <div className=\"absolute inset-0 flex flex-col items-center justify-center pointer-events-none\">\n                <PencilLine className=\"w-8 h-8 text-gray-400 mb-2\" />\n                <p className=\"text-gray-400 text-lg font-medium\">Draw here</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nCanvas.displayName = 'Canvas';\n\nexport default Canvas; "],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1147, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/ActionBar.js"],"sourcesContent":["import { Download, RefreshCw, History } from 'lucide-react';\n\nconst ActionBar = ({ handleSaveImage, handleRegenerate, onOpenHistory }) => {\n  return (\n    <div className=\"flex gap-2 bg-white rounded-xl shadow-soft p-2 border border-gray-200\">\n      <button\n        type=\"button\"\n        onClick={onOpenHistory}\n        className=\"p-2 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors\"\n        aria-label=\"View History\"\n      >\n        <History className=\"w-5 h-5\" />\n      </button>\n\n      <div className=\"w-px bg-gray-200 mx-1\" />\n      \n      <button\n        type=\"button\"\n        onClick={handleRegenerate}\n        className=\"p-2 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors\"\n        aria-label=\"Regenerate\"\n      >\n        <RefreshCw className=\"w-5 h-5\" />\n      </button>\n\n      <div className=\"w-px bg-gray-200 mx-1\" />\n      \n      <button\n        type=\"button\"\n        onClick={handleSaveImage}\n        className=\"p-2 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors\"\n        aria-label=\"Save Image\"\n      >\n        <Download className=\"w-5 h-5\" />\n      </button>\n    </div>\n  );\n};\n\nexport default ActionBar; "],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;;;AAEA,MAAM,YAAY,CAAC,EAAE,eAAe,EAAE,gBAAgB,EAAE,aAAa,EAAE;IACrE,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBACC,MAAK;gBACL,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEX,cAAA,qKAAC,iMAAA,CAAA,UAAO;oBAAC,WAAU;;;;;;;;;;;0BAGrB,qKAAC;gBAAI,WAAU;;;;;;0BAEf,qKAAC;gBACC,MAAK;gBACL,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEX,cAAA,qKAAC,yMAAA,CAAA,YAAS;oBAAC,WAAU;;;;;;;;;;;0BAGvB,qKAAC;gBAAI,WAAU;;;;;;0BAEf,qKAAC;gBACC,MAAK;gBACL,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEX,cAAA,qKAAC,mMAAA,CAAA,WAAQ;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAI5B;uCAEe","debugId":null}},
    {"offset": {"line": 1239, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/ImageRefiner.js"],"sourcesContent":["import { useState } from 'react';\nimport { Send } from 'lucide-react';\n\nconst ImageRefiner = ({ \n  onRefine,\n  isLoading,\n  hasGeneratedContent\n}) => {\n  const [inputValue, setInputValue] = useState('');\n  \n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (!inputValue.trim()) return;\n    onRefine(inputValue);\n    setInputValue('');\n  };\n\n  if (!hasGeneratedContent) return null;\n\n  return (\n    <form onSubmit={handleSubmit} className=\"flex gap-2\">\n      <input\n        type=\"text\"\n        value={inputValue}\n        onChange={(e) => setInputValue(e.target.value)}\n        placeholder=\"Type to refine the image...\"\n        disabled={isLoading}\n        className=\"flex-1 px-4 py-2 bg-white border border-gray-200 rounded-xl text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50 disabled:cursor-not-allowed\"\n      />\n      <button\n        type=\"submit\"\n        disabled={isLoading || !inputValue.trim()}\n        className=\"p-2 bg-gray-900 text-white rounded-xl hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n      >\n        <Send className=\"w-5 h-5\" />\n      </button>\n    </form>\n  );\n};\n\nexport default ImageRefiner; "],"names":[],"mappings":";;;;AAAA;AACA;;;;AAEA,MAAM,eAAe,CAAC,EACpB,QAAQ,EACR,SAAS,EACT,mBAAmB,EACpB;IACC,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,CAAC,WAAW,IAAI,IAAI;QACxB,SAAS;QACT,cAAc;IAChB;IAEA,IAAI,CAAC,qBAAqB,OAAO;IAEjC,qBACE,qKAAC;QAAK,UAAU;QAAc,WAAU;;0BACtC,qKAAC;gBACC,MAAK;gBACL,OAAO;gBACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;gBAC7C,aAAY;gBACZ,UAAU;gBACV,WAAU;;;;;;0BAEZ,qKAAC;gBACC,MAAK;gBACL,UAAU,aAAa,CAAC,WAAW,IAAI;gBACvC,WAAU;0BAEV,cAAA,qKAAC,2LAAA,CAAA,OAAI;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAIxB;uCAEe","debugId":null}},
    {"offset": {"line": 1303, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/DisplayCanvas.js"],"sourcesContent":["import { LoaderCircle, ImageIcon, Send, RotateCw, Maximize, Wand2, Sun, Plus, Palette, Image as ImageLucide } from 'lucide-react';\nimport { useEffect, useState } from 'react';\nimport ActionBar from './ActionBar';\nimport ImageRefiner from './ImageRefiner';\n\n// Update REFINEMENT_SUGGESTIONS with cleaner labels and full prompts\nconst REFINEMENT_SUGGESTIONS = [\n  { label: 'Rotate', prompt: 'Can you rotate this by ', icon: RotateCw },\n  { label: 'Add light', prompt: 'Can you add a light from the ', icon: Sun },\n  { label: 'Add object', prompt: 'Can you add a ', icon: Plus },\n  { label: 'Background', prompt: 'Can you change the background to ', icon: ImageLucide },\n  { label: 'Color', prompt: 'Can you make the color more ', icon: Palette },\n  { label: 'Scale', prompt: 'Can you make this ', icon: Maximize },\n  { label: 'Lighting', prompt: 'Can you make the lighting more ', icon: Sun },\n  { label: 'Style', prompt: 'Can you make it look more ', icon: Wand2 },\n  { label: 'Material', prompt: 'Can you change the material to ', icon: Wand2 },\n  // Add more suggestions as needed...\n];\n\nconst DisplayCanvas = ({ \n  displayCanvasRef, \n  isLoading,\n  handleSaveImage,\n  handleRegenerate,\n  hasGeneratedContent = false,\n  currentDimension,\n  onOpenHistory,\n  onRefineImage\n}) => {\n  // Use a local state that combines props with local state\n  const [showPlaceholder, setShowPlaceholder] = useState(true);\n  const [inputValue, setInputValue] = useState('');\n  \n  // Update placeholder visibility when loading or content prop changes\n  useEffect(() => {\n    if (hasGeneratedContent) {\n      setShowPlaceholder(false);\n    } else if (isLoading) {\n      setShowPlaceholder(true);\n    }\n  }, [isLoading, hasGeneratedContent]);\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (!inputValue.trim()) return;\n    onRefineImage(inputValue);\n    setInputValue('');\n  };\n\n  const handleSuggestionClick = (suggestion) => {\n    // Use the full prompt when clicking the suggestion\n    setInputValue(suggestion.prompt);\n    // Optional: Focus the input after clicking suggestion\n    document.querySelector('input[name=\"refiner\"]').focus();\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4\">\n      <div className=\"relative w-full flex justify-center\">\n        <canvas\n          ref={displayCanvasRef}\n          width={currentDimension.width}\n          height={currentDimension.height}\n          className=\"border border-gray-300 bg-white rounded-xl shadow-soft\"\n          style={{\n            aspectRatio: `${currentDimension.width} / ${currentDimension.height}`,\n            maxWidth: '100%',\n            maxHeight: '600px',\n            width: 'auto',\n            height: 'auto'\n          }}\n          aria-label=\"Generated image canvas\"\n        />\n        \n        {/* Loading overlay */}\n        {isLoading && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-black/5 rounded-xl\">\n            <div className=\"bg-white/90 rounded-full p-3 shadow-medium\">\n              <LoaderCircle className=\"w-8 h-8 animate-spin text-gray-700\" />\n            </div>\n          </div>\n        )}\n        \n        {/* Placeholder overlay - only show when not loading and no content has been generated */}\n        {showPlaceholder && !isLoading && !hasGeneratedContent && (\n          <div className=\"absolute inset-0 flex flex-col items-center justify-center pointer-events-none\">\n            <ImageIcon className=\"w-7 h-7 text-gray-400 mb-2\" />\n            <p className=\"text-gray-400 text-lg font-medium\">Generation will appear here</p>\n          </div>\n        )}\n      </div>\n\n      <div className=\"w-full space-y-4\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex-1\">\n            {hasGeneratedContent && (\n              <form onSubmit={handleSubmit} className=\"flex\">\n                <div className=\"flex-1 flex items-center bg-white rounded-xl shadow-soft p-2 border border-gray-200\">\n                  <input\n                    name=\"refiner\"\n                    type=\"text\"\n                    value={inputValue}\n                    onChange={(e) => setInputValue(e.target.value)}\n                    placeholder=\"Type to refine the image...\"\n                    disabled={isLoading}\n                    className=\"flex-1 px-2 bg-transparent border-none text-gray-600 placeholder-gray-300 focus:outline-none\"\n                  />\n                  <button\n                    type=\"submit\"\n                    disabled={isLoading || !inputValue.trim()}\n                    className=\"p-2 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                    aria-label=\"Send refinement\"\n                  >\n                    <Send className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              </form>\n            )}\n          </div>\n\n          <ActionBar\n            handleSaveImage={handleSaveImage}\n            handleRegenerate={handleRegenerate}\n            onOpenHistory={onOpenHistory}\n          />\n        </div>\n\n        {hasGeneratedContent && (\n          <>\n            {/* Refined suggestion chips with constrained width and natural sizing */}\n            <div className=\"flex flex-wrap gap-1.5\" style={{ width: 'calc(100% - 144px)' }}>\n              {REFINEMENT_SUGGESTIONS.map((suggestion, index) => (\n                <button\n                  key={index}\n                  onClick={() => handleSuggestionClick(suggestion)}\n                  className=\"flex items-center gap-1.5 px-2 py-0.5 text-xs bg-white hover:bg-gray-50 rounded-full border border-gray-200 text-gray-400 opacity-60 hover:text-gray-600 hover:opacity-100 transition-all focus:outline-none focus:ring-2 focus:ring-gray-200\"\n                >\n                  <suggestion.icon className=\"w-3.5 h-3.5\" />\n                  <span>{suggestion.label}</span>\n                </button>\n              ))}\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default DisplayCanvas; "],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1606, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/StyleSelector.js"],"sourcesContent":["import { useState, useRef, useEffect } from 'react';\nimport { RefreshCw, Plus, Upload, Edit, Trash2, RefreshCcw, HelpCircle } from 'lucide-react';\n\n// Define default style options with display names and prompts\nconst defaultStyleOptions = {\n  material: {\n    name: \"Chrome\",\n    file: \"chrome.jpeg\",\n    prompt: \"Recreate this doodle as a physical chrome sculpture made of a chromium metal tubes or pipes in a professional studio setting. If it is typography, render it accordingly, but always always have a black background and studio lighting. Render it in Cinema 4D with Octane, using studio lighting against a pure black background. Make it look like a high-end product rendering of a sculptural piece. Flat Black background always\"\n  },\n  honey: {\n    name: \"Honey\",\n    file: \"honey.jpeg\",\n    prompt: \"Transform this sketch into a honey. Render it as if made entirely of translucent, golden honey with characteristic viscous drips and flows. Add realistic liquid properties including surface tension, reflections, and light refraction. Render it in Cinema 4D with Octane, using studio lighting against a pure black background. Flat Black background always\"\n  },\n  softbody: {\n    name: \"Soft Body\",\n    file: \"softbody.jpeg\",\n    prompt: \"Convert this drawing / text into a soft body physics render. Render it as if made of a soft, jelly-like material that responds to gravity and motion. Add realistic deformation, bounce, and squash effects typical of soft body dynamics. Use dramatic lighting against a black background to emphasize the material's translucency and surface properties. Render it in Cinema 4D with Octane, using studio lighting against a pure black background. Make it look like a high-end 3D animation frame.\"\n  },\n  topographic: {\n    name: \"Topographic\",\n    file: \"topographic.jpeg\",\n    prompt: \"Transform this sketch into a sculptural form composed of precisely stacked, thin metallic rings or layers. Render it with warm copper/bronze tones with each layer maintaining equal spacing from adjacent layers, creating a topographic map effect. The form should appear to flow and undulate while maintaining the precise parallel structure. Use dramatic studio lighting against a pure black background to highlight the metallic luster and dimensional quality. Render it in a high-end 3D visualization style with perfect definition between each ring layer.\"\n  },\n  testMaterial: {\n    name: \"Surprise Me!\",\n    file: \"test-material.jpeg\",\n    prompt: \"Transform this sketch into an experimental material with unique and unexpected properties. Each generation should be different and surprising - it could be crystalline, liquid, gaseous, organic, metallic, or something completely unexpected. Use dramatic studio lighting against a pure black background to showcase the material's unique characteristics. Render it in a high-end 3D style with professional lighting and composition, emphasizing the most interesting and unexpected qualities of the chosen material.\"\n  }\n};\n\n// Create a mutable copy that will include user-added materials\nexport let styleOptions = { ...defaultStyleOptions };\n\n// Define the base prompt template\nconst BASE_PROMPT = (materialName) => \n  `Transform this sketch into a ${materialName.toLowerCase()} material. Render it in a high-end 3D visualization style with professional studio lighting against a pure black background. Make it look like an elegant Cinema 4D and Octane rendering with detailed material properties and characteristics. The final result should be an elegant visualization with perfect studio lighting, crisp shadows, and high-end material definition.`;\n\nconst enhanceMaterialDetails = async (materialDescription) => {\n  console.log(\"Enhancing material:\", materialDescription);\n  try {\n    const response = await fetch(\"/api/enhance-material\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ materialDescription })\n    });\n    \n    const data = await response.json();\n    console.log(\"Enhanced material data:\", data);\n    \n    // If we have valid data, use it\n    if (data.name && typeof data.details === 'string') {\n      // Strictly combine base prompt with only the additional details\n      const finalPrompt = data.details.trim()\n        ? `${BASE_PROMPT(data.name)}. ${data.details.trim()}`\n        : BASE_PROMPT(data.name);\n      \n      return {\n        name: data.name,\n        prompt: finalPrompt\n      };\n    }\n    \n    // If data is invalid, throw error to trigger fallback\n    throw new Error('Invalid enhancement data received');\n  } catch (error) {\n    console.error(\"Error enhancing material details:\", error);\n    \n    // Create a more sophisticated fallback that still provides value\n    const capitalizedName = materialDescription\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    const fallbackPrompt = `${BASE_PROMPT(materialDescription)}. Emphasize the characteristic properties of ${materialDescription.toLowerCase()} with accurate surface texturing and physical behavior.`;\n    \n    return {\n      name: `${capitalizedName} Material`,\n      prompt: fallbackPrompt\n    };\n  }\n};\n\n// Function to get prompt based on style mode\nexport const getPromptForStyle = (styleMode) => {\n  if (!styleMode || !styleOptions[styleMode]) {\n    return styleOptions.material.prompt;\n  }\n  return styleOptions[styleMode].prompt || styleOptions.material.prompt;\n};\n\n// Replace with a simpler generatePromptForMaterial function\nexport const generatePromptForMaterial = (materialName) => {\n  return `Transform this sketch into a ${materialName.toLowerCase()} material. Render it in a high-end 3D visualization style with professional studio lighting against a pure black background. Make it look like a elegant Cinema 4D and octane rendering with detailed material properties and characteristics.`;\n};\n\nconst StyleSelector = ({ styleMode, setStyleMode, handleGenerate }) => {\n  const [showAddMaterialModal, setShowAddMaterialModal] = useState(false);\n  const [newMaterialName, setNewMaterialName] = useState('');\n  const [isGeneratingThumbnail, setIsGeneratingThumbnail] = useState(false);\n  const [useCustomImage, setUseCustomImage] = useState(false);\n  const [customImagePreview, setCustomImagePreview] = useState('');\n  const [customImageFile, setCustomImageFile] = useState(null);\n  const fileInputRef = useRef(null);\n  const [recentlyAdded, setRecentlyAdded] = useState(null);\n  const [customPrompt, setCustomPrompt] = useState('');\n  const [showCustomPrompt, setShowCustomPrompt] = useState(false);\n  const [previewThumbnail, setPreviewThumbnail] = useState('');\n  const [isGeneratingPreview, setIsGeneratingPreview] = useState(false);\n  const [materials, setMaterials] = useState(defaultStyleOptions);\n  const [generatedMaterialName, setGeneratedMaterialName] = useState('');\n  const [generatedPrompt, setGeneratedPrompt] = useState('');\n  const [isGeneratingText, setIsGeneratingText] = useState(false);\n  const [showMaterialNameEdit, setShowMaterialNameEdit] = useState(false);\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  // Load custom materials from local storage on component mount\n  useEffect(() => {\n    loadCustomMaterials();\n  }, []);\n\n  // Extract loadCustomMaterials into its own named function\n  const loadCustomMaterials = () => {\n    try {\n      const savedMaterials = localStorage.getItem('customMaterials');\n      if (savedMaterials) {\n        const parsedMaterials = JSON.parse(savedMaterials);\n        // Update both the styleOptions and the state\n        const updatedMaterials = { ...defaultStyleOptions, ...parsedMaterials };\n        styleOptions = updatedMaterials;\n        setMaterials(updatedMaterials);\n        console.log('Loaded custom materials from local storage');\n      }\n    } catch (error) {\n      console.error('Error loading custom materials:', error);\n    }\n  };\n\n  // Modify the useEffect that handles thumbnail and text generation\n  useEffect(() => {\n    const delayedGeneration = async () => {\n      // Skip automatic generation if we're editing (recentlyAdded exists)\n      if (!newMaterialName.trim() || recentlyAdded) return;\n      \n      // Set loading states\n      if (!useCustomImage) {\n        setIsGeneratingPreview(true);\n      }\n      setIsGeneratingText(true);\n      \n      try {\n        // Use our enhanced material details function\n        const enhanced = await enhanceMaterialDetails(newMaterialName);\n        setGeneratedMaterialName(enhanced.name);\n        setGeneratedPrompt(enhanced.prompt);\n        \n        // Generate thumbnail with the enhanced prompt\n        if (!useCustomImage) {\n          try {\n            // Generate a thumbnail using the API with the enhanced prompt\n            const response = await fetch(\"/api/generate\", {\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n              },\n              body: JSON.stringify({\n                prompt: enhanced.prompt,\n              }),\n            });\n            \n            const data = await response.json();\n            \n            if (data.success && data.imageData) {\n              // Set the preview thumbnail\n              setPreviewThumbnail(`data:image/jpeg;base64,${data.imageData}`);\n            }\n          } catch (error) {\n            console.error(\"Error generating preview thumbnail:\", error);\n          }\n        }\n      } catch (error) {\n        console.error('Error in material generation:', error);\n        \n        // Fall back to basic generation if enhanced fails\n        setGeneratedMaterialName(`${newMaterialName} Material`);\n        setGeneratedPrompt(generatePromptForMaterial(newMaterialName));\n      } finally {\n        setIsGeneratingPreview(false);\n        setIsGeneratingText(false);\n      }\n    };\n    \n    // Delay generation to avoid too many API calls while typing\n    const timeoutId = setTimeout(delayedGeneration, 1500);\n    return () => clearTimeout(timeoutId);\n  }, [newMaterialName, useCustomImage, recentlyAdded]);\n\n  // Helper function to resize and compress image data\n  const compressImage = (dataUrl, maxWidth = 200) => {\n    return new Promise((resolve) => {\n      const img = new Image();\n      img.onload = () => {\n        // Create a canvas to resize the image\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        \n        // Calculate new dimensions\n        let width = img.width;\n        let height = img.height;\n        \n        if (width > maxWidth) {\n          height = (height * maxWidth) / width;\n          width = maxWidth;\n        }\n        \n        canvas.width = width;\n        canvas.height = height;\n        \n        // Draw and export as JPEG with lower quality\n        ctx.drawImage(img, 0, 0, width, height);\n        resolve(canvas.toDataURL('image/jpeg', 0.7));\n      };\n      img.src = dataUrl;\n    });\n  };\n\n  // Function to debug storage usage\n  const checkStorageUsage = () => {\n    let totalSize = 0;\n    let itemCount = 0;\n    \n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      const value = localStorage.getItem(key);\n      const size = (key.length + value.length) * 2; // Approximate size in bytes (UTF-16)\n      totalSize += size;\n      itemCount++;\n      console.log(`Item: ${key}, Size: ${(size / 1024).toFixed(2)}KB`);\n    }\n    \n    console.log(`Total localStorage usage: ${(totalSize / 1024 / 1024).toFixed(2)}MB, Items: ${itemCount}`);\n    return totalSize;\n  };\n\n  const handleAddMaterial = () => {\n    setShowAddMaterialModal(true);\n  };\n\n  const handleCloseModal = () => {\n    setShowAddMaterialModal(false);\n    setNewMaterialName('');\n    setUseCustomImage(false);\n    setCustomImagePreview('');\n    setCustomImageFile(null);\n    setCustomPrompt('');\n    setShowCustomPrompt(false);\n    setPreviewThumbnail('');\n  };\n\n  // Handle clicking outside of the modal to close it\n  const handleClickOutsideModal = (e) => {\n    // If the clicked element is the backdrop (has the modalBackdrop class)\n    if (e.target.classList.contains('modalBackdrop')) {\n      handleCloseModal();\n    }\n  };\n\n  const handleFileChange = (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n    \n    if (!file.type.startsWith('image/')) {\n      alert('Please select an image file');\n      return;\n    }\n    \n    const reader = new FileReader();\n    reader.onload = () => {\n      // When the file is loaded, create a temporary image to extract a square crop\n      const img = new Image();\n      img.onload = () => {\n        // Create a canvas element to crop the image to a square\n        const canvas = document.createElement('canvas');\n        // Determine the size of the square (min of width and height)\n        const size = Math.min(img.width, img.height);\n        canvas.width = size;\n        canvas.height = size;\n        \n        // Calculate the position to start drawing to center the crop\n        const offsetX = (img.width - size) / 2;\n        const offsetY = (img.height - size) / 2;\n        \n        // Draw the cropped image to the canvas\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, offsetX, offsetY, size, size, 0, 0, size, size);\n        \n        // Convert the canvas to a data URL\n        const croppedImageDataUrl = canvas.toDataURL(file.type);\n        setCustomImagePreview(croppedImageDataUrl);\n        setCustomImageFile(file);\n      };\n      img.src = reader.result;\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const triggerFileInput = () => {\n    fileInputRef.current.click();\n  };\n\n  const handleGenerateDefaultPrompt = () => {\n    if (!newMaterialName.trim()) return;\n    \n    // Generate default prompt based on material name\n    const defaultPrompt = generatePromptForMaterial(newMaterialName);\n    setCustomPrompt(defaultPrompt);\n    \n    // Clear the preview so it will regenerate with the new prompt\n    setPreviewThumbnail('');\n  };\n\n  // Add a helper function to read file as data URL\n  const readFileAsDataURL = (file) => {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => resolve(reader.result);\n      reader.onerror = reject;\n      reader.readAsDataURL(file);\n    });\n  };\n\n  // Option 1: Add function to compress images more aggressively before storage\n  const compressImageForStorage = async (dataUrl) => {\n    // Use a smaller max width for storage\n    const maxWidth = 100; // Reduce from 200 to 100\n    const quality = 0.5; // Reduce quality from 0.7 to 0.5\n    \n    return new Promise((resolve) => {\n      const img = new Image();\n      img.onload = () => {\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        \n        let width = img.width;\n        let height = img.height;\n        \n        if (width > maxWidth) {\n          height = (height * maxWidth) / width;\n          width = maxWidth;\n        }\n        \n        canvas.width = width;\n        canvas.height = height;\n        \n        ctx.drawImage(img, 0, 0, width, height);\n        resolve(canvas.toDataURL('image/jpeg', quality));\n      };\n      img.src = dataUrl;\n    });\n  };\n\n  // Option 2: Add function to manage storage limits\n  const manageStorageLimit = async (newMaterial) => {\n    try {\n      // Get current materials\n      const savedMaterials = localStorage.getItem('customMaterials');\n      if (!savedMaterials) return;\n      \n      const parsedMaterials = JSON.parse(savedMaterials);\n      const customKeys = Object.keys(parsedMaterials).filter(key => \n        !Object.keys(defaultStyleOptions).includes(key));\n      \n      // If we have too many custom materials, remove the oldest ones\n      if (customKeys.length > 4) { // Limit to 5 custom materials\n        // Sort by creation time (if you have that data) or just take the first ones\n        const keysToRemove = customKeys.slice(0, customKeys.length - 4);\n        \n        keysToRemove.forEach(key => {\n          delete parsedMaterials[key];\n        });\n        \n        // Save the reduced set back to localStorage\n        localStorage.setItem('customMaterials', JSON.stringify(parsedMaterials));\n      }\n    } catch (error) {\n      console.error('Error managing storage limit:', error);\n    }\n  };\n\n  // Add a function to reset the form fields\n  const resetMaterialForm = () => {\n    setNewMaterialName('');\n    setGeneratedMaterialName('');\n    setGeneratedPrompt('');\n    setCustomPrompt('');\n    setPreviewThumbnail('');\n    setUseCustomImage(false);\n    setCustomImagePreview('');\n    setShowCustomPrompt(false);\n  };\n\n  // Update the openAddMaterialModal function to reset form on open\n  const openAddMaterialModal = () => {\n    resetMaterialForm();\n    setRecentlyAdded(null);\n    setShowAddMaterialModal(true);\n  };\n\n  // Modify handleEditMaterial to keep thumbnail when editing\n  const handleEditMaterial = (materialId) => {\n    const material = materials[materialId];\n    if (!material) return;\n    \n    // Set form fields with existing data\n    setNewMaterialName(material.originalDescription || ''); // Store original description if available\n    setGeneratedMaterialName(material.name || '');\n    \n    // Set prompt with appropriate approach\n    const materialPrompt = material.prompt || '';\n    setGeneratedPrompt(materialPrompt);\n    setCustomPrompt(materialPrompt);\n    setShowCustomPrompt(false);\n    \n    // Set thumbnail without triggering regeneration\n    if (material.thumbnail) {\n      setPreviewThumbnail(material.thumbnail);\n      setUseCustomImage(false);\n    }\n    \n    setRecentlyAdded(materialId);\n    setShowAddMaterialModal(true);\n  };\n\n  // Add a function to manually refresh the thumbnail\n  const handleRefreshThumbnail = async (prompt) => {\n    if (!newMaterialName.trim() || useCustomImage) return;\n    \n    setIsGeneratingPreview(true);\n    \n    try {\n      // Use the current prompt (either custom or default)\n      const promptToUse = showCustomPrompt && customPrompt.trim()\n        ? customPrompt\n        : generatePromptForMaterial(newMaterialName);\n      \n      // Generate a new thumbnail using the API\n      const response = await fetch(\"/api/generate\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          prompt: promptToUse,\n        }),\n      });\n      \n      const data = await response.json();\n      \n      if (data.success && data.imageData) {\n        // Set the preview thumbnail\n        setPreviewThumbnail(`data:image/jpeg;base64,${data.imageData}`);\n      }\n    } catch (error) {\n      console.error(\"Error generating preview thumbnail:\", error);\n    } finally {\n      setIsGeneratingPreview(false);\n    }\n  };\n\n  // Add a function to manually refresh the text\n  const handleRefreshText = async () => {\n    if (!newMaterialName.trim()) return;\n    \n    setIsGeneratingText(true);\n    \n    try {\n      // ... existing code for text generation ...\n      // This can reuse the same code from the useEffect\n    } catch (error) {\n      console.error(\"Error generating material name and prompt:\", error);\n    } finally {\n      setIsGeneratingText(false);\n    }\n  };\n\n  const handleNewMaterialDescription = async (description) => {\n    if (!description.trim()) return;\n    \n    setIsGeneratingText(true);\n    try {\n      const enhanced = await enhanceMaterialDetails(description);\n      setGeneratedMaterialName(enhanced.name);\n      setGeneratedPrompt(enhanced.prompt);\n      \n      // Trigger thumbnail generation with the new prompt\n      if (!useCustomImage) {\n        handleRefreshThumbnail(enhanced.prompt);\n      }\n    } catch (error) {\n      console.error(\"Error generating material:\", error);\n    } finally {\n      setIsGeneratingText(false);\n    }\n  };\n\n  const handleCreateMaterial = async () => {\n    if (!newMaterialName.trim()) return;\n    \n    // Generate a unique ID for the material\n    const materialId = recentlyAdded || `custom_${Date.now()}`;\n    \n    // Use the generated material name instead of the description\n    const displayName = generatedMaterialName || `${newMaterialName} Material`;\n    \n    // Use the generated or custom prompt\n    const materialPrompt = showCustomPrompt ? customPrompt : (generatedPrompt || generatePromptForMaterial(newMaterialName));\n    \n    // Create the new material object\n    const newMaterial = {\n      name: displayName,\n      prompt: materialPrompt,\n      thumbnail: useCustomImage ? customImagePreview : previewThumbnail,\n      originalDescription: newMaterialName, // Store the original description for editing\n      isCustom: true\n    };\n    \n    // Update both our state and storage references\n    const updatedMaterials = { ...materials, [materialId]: newMaterial };\n    \n    // Apply more aggressive compression before storing\n    if (useCustomImage && customImagePreview) {\n      newMaterial.thumbnail = await compressImageForStorage(customImagePreview);\n    } else if (previewThumbnail) {\n      newMaterial.thumbnail = await compressImageForStorage(previewThumbnail);\n    }\n    \n    // Before trying to save, manage storage limit\n    await manageStorageLimit(newMaterial);\n    \n    try {\n      // Save to localStorage\n      localStorage.setItem('customMaterials', JSON.stringify(updatedMaterials));\n      \n      // Update state and global reference\n      styleOptions = updatedMaterials;\n      setMaterials(updatedMaterials);\n      \n      // Set as recently added for highlight effect\n      setRecentlyAdded(materialId);\n      \n      // Switch to the new material mode\n      setStyleMode(materialId);\n      \n      // Close the modal\n      setShowAddMaterialModal(false);\n      \n      // Reset form\n      resetMaterialForm();\n      \n      console.log(\"Material created successfully:\", materialId);\n    } catch (error) {\n      // If we still hit quota errors, implement fallback\n      console.error('Storage error:', error);\n      \n      // Fallback: Store only the most recent materials\n      const reducedMaterials = {};\n      \n      // Keep just the new material and the default ones\n      reducedMaterials[materialId] = newMaterial;\n      \n      // Try to save just this one\n      try {\n        localStorage.setItem('customMaterials', JSON.stringify(reducedMaterials));\n        styleOptions = {...defaultStyleOptions, ...reducedMaterials};\n        setMaterials(styleOptions);\n      } catch (secondError) {\n        // If even that fails, alert the user\n        alert(\"Couldn't save your material due to storage limitations. Try clearing some browser data.\");\n      }\n    }\n  };\n\n  const handleDeleteMaterial = (event, key) => {\n    event.stopPropagation(); // Prevent triggering the parent button's onClick\n    \n    // Only allow deleting custom materials\n    if (styleOptions[key]?.isCustom) {\n      if (window.confirm(`Are you sure you want to delete the \"${styleOptions[key].name}\" material?`)) {\n        // If currently selected, switch to default material\n        if (styleMode === key) {\n          setStyleMode('material');\n        }\n        \n        // Delete the material\n        const { [key]: deleted, ...remaining } = styleOptions;\n        const updatedMaterials = { ...defaultStyleOptions, ...remaining };\n        styleOptions = updatedMaterials;\n        setMaterials(updatedMaterials);\n        \n        // Save the updated materials\n        const customMaterials = {};\n        Object.entries(remaining).forEach(([k, v]) => {\n          if (!defaultStyleOptions[k]) {\n            customMaterials[k] = v;\n          }\n        });\n        localStorage.setItem('customMaterials', JSON.stringify(customMaterials));\n      }\n    }\n  };\n\n  // Add a function to sort materials in the desired order\n  const getSortedMaterials = (materials) => {\n    // 1. Get original materials (excluding Test Material)\n    const originalMaterials = Object.entries(defaultStyleOptions)\n      .filter(([key]) => key !== 'testMaterial')\n      .reduce((acc, [key, value]) => ({ ...acc, [key]: value }), {});\n\n    // 2. Get custom/locally saved materials (excluding Test Material)\n    const customMaterials = Object.entries(materials)\n      .filter(([key]) => !defaultStyleOptions[key] && key !== 'testMaterial')\n      .reduce((acc, [key, value]) => ({ ...acc, [key]: value }), {});\n\n    // 3. Get Test Material\n    const testMaterial = materials.testMaterial ? { testMaterial: materials.testMaterial } : {};\n\n    // Combine in desired order\n    return {\n      ...originalMaterials,\n      ...customMaterials,\n      ...testMaterial\n    };\n  };\n\n  // Fix the reference image upload function\n  const handleReferenceImageUpload = async (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    \n    // Clear recentlyAdded to ensure we're not in edit mode\n    setRecentlyAdded(null);\n    \n    // Set loading states\n    setIsGeneratingText(true);\n    setIsGeneratingPreview(true);\n    \n    try {\n      // Process the image for preview\n      const reader = new FileReader();\n      reader.onloadend = async (event) => {\n        const imageDataUrl = event.target.result;\n        \n        // Set UI state for image\n        setCustomImagePreview(imageDataUrl);\n        setUseCustomImage(true);\n        \n        // Call the analyze-image API\n        try {\n          const response = await fetch('/api/analyze-image', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ image: imageDataUrl }),\n          });\n          \n          if (!response.ok) {\n            throw new Error(`API returned ${response.status}`);\n          }\n          \n          const data = await response.json();\n          \n          if (data.prompt && data.suggestedName) {\n            // Update the material information\n            setGeneratedMaterialName(data.suggestedName);\n            setNewMaterialName(data.suggestedName);\n            setGeneratedPrompt(data.prompt);\n            setCustomPrompt(data.prompt);\n            setShowCustomPrompt(true);\n          }\n        } catch (error) {\n          console.error('Error analyzing reference image:', error);\n          // Set fallback values\n          setGeneratedMaterialName('Reference Material');\n          setNewMaterialName('Reference Material');\n          setGeneratedPrompt('Transform this reference into a 3D rendering with dramatic lighting on a black background.');\n          setCustomPrompt('Transform this reference into a 3D rendering with dramatic lighting on a black background.');\n        } finally {\n          setIsGeneratingText(false);\n          setIsGeneratingPreview(false);\n        }\n      };\n      \n      reader.readAsDataURL(file);\n    } catch (error) {\n      console.error('Error processing image:', error);\n      setIsGeneratingText(false);\n      setIsGeneratingPreview(false);\n    }\n  };\n\n  return (\n    <div className=\"w-full\">\n      <div className=\"overflow-x-auto\">\n        <div className=\"flex flex-wrap gap-2 overflow-y-auto max-h-[35vh] pr-2\">\n          {/* 1. Original + 2. Local + 3. Test Material */}\n          {Object.entries(getSortedMaterials(materials)).map(([key, { name, file, imageData, thumbnail, isCustom }]) => (\n            <button\n              key={key}\n              onClick={async () => {\n                const isSameMaterial = styleMode === key;\n                if (!isSameMaterial) {\n                  setStyleMode(key);\n                } else {\n                  handleGenerate();\n                }\n              }}\n              type=\"button\"\n              aria-label={`Select ${name} style`}\n              aria-pressed={styleMode === key}\n              className=\"focus:outline-none relative group\"\n            >\n              <div className={`w-20 border ${\n                key === 'testMaterial' \n                  ? styleMode === key ? 'border-blue-500' : 'border-gray-200 border-dashed'\n                  : styleMode === key ? 'border-blue-500' : 'border-gray-200'\n              } overflow-hidden rounded-xl ${\n                styleMode === key \n                  ? 'bg-white' \n                  : 'bg-gray-50'\n              }`}>\n                {/* Image container - fixed to be square */}\n                <div className=\"w-full relative\" style={{ aspectRatio: '1/1' }}>\n                  {key === 'testMaterial' ? (\n                    <div className=\"w-full h-full flex items-center justify-center bg-gray-50\">\n                      <HelpCircle className=\"w-8 h-8 text-gray-400\" />\n                    </div>\n                  ) : (\n                    <img \n                      src={imageData ? `data:image/jpeg;base64,${imageData}` : (file ? `/samples/${file}` : thumbnail || '')}\n                      alt={`${name} style example`}\n                      className=\"w-full h-full object-cover\"\n                      onError={(e) => {\n                        console.error(`Error loading thumbnail for ${name}`);\n                        e.target.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=';\n                      }}\n                    />\n                  )}\n                  {/* Improved control buttons for materials */}\n                  {isCustom && (\n                    <div className=\"absolute inset-0\">\n                      <div className=\"opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <button\n                          onClick={(e) => {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            handleEditMaterial(key);\n                          }}\n                          className=\"absolute top-1 right-1 bg-gray-800 bg-opacity-70 hover:bg-opacity-90 text-white rounded-full w-5 h-5 flex items-center justify-center transition-opacity\"\n                          aria-label={`Edit ${name} material`}\n                        >\n                          <Edit className=\"w-2.5 h-2.5\" />\n                        </button>\n                        <button\n                          onClick={(e) => {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            handleDeleteMaterial(e, key);\n                          }}\n                          className=\"absolute top-1 left-1 bg-gray-800 bg-opacity-70 hover:bg-opacity-90 text-white rounded-full w-5 h-5 flex items-center justify-center transition-opacity\"\n                          aria-label={`Delete ${name} material`}\n                        >\n                          <Trash2 className=\"w-2.5 h-2.5\" />\n                        </button>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                {/* Label below image */}\n                <div className={`px-1 py-1 text-left text-xs font-medium border-t border-gray-200 ${\n                  styleMode === key \n                    ? 'bg-blue-50 text-blue-600'\n                    : 'bg-white text-gray-600'\n                }`}>\n                  <div className=\"truncate\">\n                    {name}\n                  </div>\n                </div>\n              </div>\n            </button>\n          ))}\n          \n          {/* 4. Add Material Button - Always at the end */}\n          <button\n            onClick={handleAddMaterial}\n            type=\"button\"\n            aria-label=\"Add new material\"\n            className=\"focus:outline-none\"\n          >\n            <div className=\"w-20 border border-dashed border-gray-200 overflow-hidden rounded-xl bg-gray-50 flex flex-col\">\n              <div className=\"w-full relative\" style={{ aspectRatio: '1/1' }}>\n                <div className=\"flex items-center justify-center h-full\">\n                  <Plus className=\"w-8 h-8 text-gray-400\" />\n                </div>\n              </div>\n              <div className=\"px-1 py-1 text-left text-xs font-medium border-t border-gray-200 bg-gray-100 text-gray-600 w-full\">\n                <div className=\"truncate\">\n                  Add Material\n                </div>\n              </div>\n            </div>\n          </button>\n        </div>\n      </div>\n\n      {/* Add Material Modal - Updated with semi-transparent backdrop */}\n      {showAddMaterialModal && (\n        <div \n          className=\"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 modalBackdrop\"\n          onClick={handleClickOutsideModal}\n        >\n          <div \n            className=\"bg-white p-6 rounded-xl shadow-medium max-w-2xl w-full\"\n            onClick={(e) => e.stopPropagation()}  // Prevent clicks inside from closing the modal\n          >\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-2xl font-bold text-black\">Add Material</h2>\n            </div>\n\n            {/* Material Description and Preview section - reorganized */}\n            <div className=\"mb-6\">\n              {/* Description and thumbnail in the same row */}\n              <div className=\"flex gap-6 items-start mb-6\">\n                {/* Material Description */}\n                <div className=\"flex-1\">\n                  <label className=\"block text-black text-base mb-2\">Describe your material</label>\n                  <input\n                    type=\"text\"\n                    value={newMaterialName}\n                    onChange={(e) => setNewMaterialName(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-black\"\n                    placeholder=\"Eg. Bubbles, glass etc\"\n                  />\n                </div>\n\n                {/* Thumbnail Preview - Moved back to top right */}\n                <div>\n                  <div className=\"relative w-[120px] h-[120px] rounded-lg overflow-hidden border border-gray-200\">\n                    {(previewThumbnail || customImagePreview) ? (\n                      <img \n                        src={useCustomImage ? customImagePreview : previewThumbnail} \n                        alt=\"Material preview\"\n                        className=\"w-full h-full object-cover\"\n                      />\n                    ) : (\n                      <div className=\"w-full h-full bg-gray-50 flex items-center justify-center\">\n                        <p className=\"text-gray-400 text-sm text-center px-4\">\n                          {isGeneratingPreview ? 'Generating...' : 'Preview'}\n                        </p>\n                      </div>\n                    )}\n                    {isGeneratingPreview && (\n                      <div className=\"absolute inset-0 bg-black/5 flex items-center justify-center\">\n                        <div className=\"bg-white/90 rounded-full p-2\">\n                          <RefreshCw className=\"w-5 h-5 animate-spin text-gray-700\" />\n                        </div>\n                      </div>\n                    )}\n                    \n                    {/* Add refresh button */}\n                    {(previewThumbnail || customImagePreview) && !isGeneratingPreview && !useCustomImage && (\n                      <button\n                        onClick={() => handleRefreshThumbnail(customPrompt)}\n                        className=\"absolute top-1 right-1 bg-white/80 rounded-full p-1 hover:bg-white transition-colors\"\n                        title=\"Refresh thumbnail\"\n                      >\n                        <RefreshCcw className=\"w-4 h-4 text-gray-600\" />\n                      </button>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              {/* Upload Reference - Shorter, not square */}\n              <div className=\"w-full\">\n                <label className=\"block text-black text-base mb-2\">Or upload a reference image</label>\n                <div \n                  className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center cursor-pointer hover:bg-gray-50 transition-colors\"\n                  onClick={() => fileInputRef.current?.click()}\n                  style={{ height: \"100px\" }}  // Shorter height\n                >\n                  <div className=\"flex flex-row items-center gap-3\">\n                    <Upload className=\"w-8 h-8 text-gray-400\" />\n                    <p className=\"text-gray-500\">Upload</p>\n                  </div>\n                  <input\n                    ref={fileInputRef}\n                    type=\"file\"\n                    accept=\"image/*\"\n                    className=\"hidden\"\n                    onChange={handleReferenceImageUpload}\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* Material Name field with generated content */}\n            <div className=\"mb-4\">\n              <div className=\"flex items-center justify-between mb-1\">\n                <label className=\"block text-black font-medium\">\n                  Material Name\n                </label>\n                {!showMaterialNameEdit && (\n                  <button\n                    onClick={() => setShowMaterialNameEdit(true)}\n                    className=\"p-1 text-gray-400 hover:text-gray-600 transition-colors\"\n                    title=\"Edit material name\"\n                  >\n                    <Edit className=\"w-4 h-4\" />\n                  </button>\n                )}\n              </div>\n              <div className=\"relative\">\n                {showMaterialNameEdit ? (\n                  <input\n                    type=\"text\"\n                    value={generatedMaterialName}\n                    onChange={(e) => setGeneratedMaterialName(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    placeholder=\"Enter material name\"\n                  />\n                ) : (\n                  <div className=\"w-full px-3 py-2 bg-gray-50 rounded-lg text-gray-700\">\n                    {generatedMaterialName || 'Generating material name...'}\n                  </div>\n                )}\n                {isGeneratingText && (\n                  <div className=\"absolute right-3 top-1/2 transform -translate-y-1/2\">\n                    <RefreshCw className=\"w-4 h-4 animate-spin text-gray-400\" />\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Prompt section */}\n            <div className=\"mb-4\">\n              <div className=\"flex items-center justify-between mb-1\">\n                <label className=\"block text-black font-medium\">\n                  Prompt\n                </label>\n                {!showCustomPrompt && (\n                  <button\n                    onClick={() => setShowCustomPrompt(true)}\n                    className=\"p-1 text-gray-400 hover:text-gray-600 transition-colors\"\n                    title=\"Edit prompt\"\n                  >\n                    <Edit className=\"w-4 h-4\" />\n                  </button>\n                )}\n              </div>\n              \n              <div className=\"relative\">\n                {showCustomPrompt ? (\n                  <>\n                    <textarea\n                      value={customPrompt}\n                      onChange={(e) => setCustomPrompt(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-32\"\n                      placeholder=\"Enter custom prompt\"\n                    />\n                    <div className=\"flex justify-end mt-1\">\n                      <button\n                        type=\"button\"\n                        onClick={() => {\n                          setCustomPrompt(generatedPrompt);\n                          setShowCustomPrompt(false);\n                        }}\n                        className=\"text-xs text-blue-600 hover:text-blue-800\"\n                      >\n                        Reset to Generated\n                      </button>\n                    </div>\n                  </>\n                ) : (\n                  <div className=\"w-full px-3 py-2 bg-gray-50 rounded-lg text-gray-700 h-32 overflow-y-auto\">\n                    {generatedPrompt || 'Generating prompt...'}\n                  </div>\n                )}\n                {isGeneratingText && (\n                  <div className=\"absolute right-3 top-3\">\n                    <RefreshCw className=\"w-4 h-4 animate-spin text-gray-400\" />\n                  </div>\n                )}\n              </div>\n            </div>\n            \n            <div className=\"flex justify-end gap-3 mt-6\">\n              <button\n                onClick={() => setShowAddMaterialModal(false)}\n                className=\"px-4 py-2 text-gray-600 hover:text-gray-800\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleCreateMaterial}\n                disabled={isGeneratingThumbnail || !newMaterialName.trim()}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n              >\n                Create Material\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default StyleSelector; "],"names":[],"mappings":";;;;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAEA,8DAA8D;AAC9D,MAAM,sBAAsB;IAC1B,UAAU;QACR,MAAM;QACN,MAAM;QACN,QAAQ;IACV;IACA,OAAO;QACL,MAAM;QACN,MAAM;QACN,QAAQ;IACV;IACA,UAAU;QACR,MAAM;QACN,MAAM;QACN,QAAQ;IACV;IACA,aAAa;QACX,MAAM;QACN,MAAM;QACN,QAAQ;IACV;IACA,cAAc;QACZ,MAAM;QACN,MAAM;QACN,QAAQ;IACV;AACF;AAGO,IAAI,eAAe;IAAE,GAAG,mBAAmB;AAAC;AAEnD,kCAAkC;AAClC,MAAM,cAAc,CAAC,eACnB,CAAC,6BAA6B,EAAE,aAAa,WAAW,GAAG,kXAAkX,CAAC;AAEhb,MAAM,yBAAyB,OAAO;IACpC,QAAQ,GAAG,CAAC,uBAAuB;IACnC,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,yBAAyB;YACpD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAoB;QAC7C;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC,2BAA2B;QAEvC,gCAAgC;QAChC,IAAI,KAAK,IAAI,IAAI,OAAO,KAAK,OAAO,KAAK,UAAU;YACjD,gEAAgE;YAChE,MAAM,cAAc,KAAK,OAAO,CAAC,IAAI,KACjC,GAAG,YAAY,KAAK,IAAI,EAAE,EAAE,EAAE,KAAK,OAAO,CAAC,IAAI,IAAI,GACnD,YAAY,KAAK,IAAI;YAEzB,OAAO;gBACL,MAAM,KAAK,IAAI;gBACf,QAAQ;YACV;QACF;QAEA,sDAAsD;QACtD,MAAM,IAAI,MAAM;IAClB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QAEnD,iEAAiE;QACjE,MAAM,kBAAkB,oBACrB,KAAK,CAAC,KACN,GAAG,CAAC,CAAA,OAAQ,KAAK,MAAM,CAAC,GAAG,WAAW,KAAK,KAAK,KAAK,CAAC,GAAG,WAAW,IACpE,IAAI,CAAC;QAER,MAAM,iBAAiB,GAAG,YAAY,qBAAqB,6CAA6C,EAAE,oBAAoB,WAAW,GAAG,uDAAuD,CAAC;QAEpM,OAAO;YACL,MAAM,GAAG,gBAAgB,SAAS,CAAC;YACnC,QAAQ;QACV;IACF;AACF;AAGO,MAAM,oBAAoB,CAAC;IAChC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,UAAU,EAAE;QAC1C,OAAO,aAAa,QAAQ,CAAC,MAAM;IACrC;IACA,OAAO,YAAY,CAAC,UAAU,CAAC,MAAM,IAAI,aAAa,QAAQ,CAAC,MAAM;AACvE;AAGO,MAAM,4BAA4B,CAAC;IACxC,OAAO,CAAC,6BAA6B,EAAE,aAAa,WAAW,GAAG,8OAA8O,CAAC;AACnT;AAEA,MAAM,gBAAgB,CAAC,EAAE,SAAS,EAAE,YAAY,EAAE,cAAc,EAAE;IAChE,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACjE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACvD,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACnE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACrD,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IAC7D,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACvD,MAAM,eAAe,CAAA,GAAA,mGAAA,CAAA,SAAM,AAAD,EAAE;IAC5B,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACnD,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACjD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACzD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACzD,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IAC/D,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IAC3C,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACnE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACvD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACzD,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACjE,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IAEjD,8DAA8D;IAC9D,CAAA,GAAA,mGAAA,CAAA,YAAS,AAAD,EAAE;QACR;IACF,GAAG,EAAE;IAEL,0DAA0D;IAC1D,MAAM,sBAAsB;QAC1B,IAAI;YACF,MAAM,iBAAiB,aAAa,OAAO,CAAC;YAC5C,IAAI,gBAAgB;gBAClB,MAAM,kBAAkB,KAAK,KAAK,CAAC;gBACnC,6CAA6C;gBAC7C,MAAM,mBAAmB;oBAAE,GAAG,mBAAmB;oBAAE,GAAG,eAAe;gBAAC;gBACtE,eAAe;gBACf,aAAa;gBACb,QAAQ,GAAG,CAAC;YACd;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,mCAAmC;QACnD;IACF;IAEA,kEAAkE;IAClE,CAAA,GAAA,mGAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,oBAAoB;YACxB,oEAAoE;YACpE,IAAI,CAAC,gBAAgB,IAAI,MAAM,eAAe;YAE9C,qBAAqB;YACrB,IAAI,CAAC,gBAAgB;gBACnB,uBAAuB;YACzB;YACA,oBAAoB;YAEpB,IAAI;gBACF,6CAA6C;gBAC7C,MAAM,WAAW,MAAM,uBAAuB;gBAC9C,yBAAyB,SAAS,IAAI;gBACtC,mBAAmB,SAAS,MAAM;gBAElC,8CAA8C;gBAC9C,IAAI,CAAC,gBAAgB;oBACnB,IAAI;wBACF,8DAA8D;wBAC9D,MAAM,WAAW,MAAM,MAAM,iBAAiB;4BAC5C,QAAQ;4BACR,SAAS;gCACP,gBAAgB;4BAClB;4BACA,MAAM,KAAK,SAAS,CAAC;gCACnB,QAAQ,SAAS,MAAM;4BACzB;wBACF;wBAEA,MAAM,OAAO,MAAM,SAAS,IAAI;wBAEhC,IAAI,KAAK,OAAO,IAAI,KAAK,SAAS,EAAE;4BAClC,4BAA4B;4BAC5B,oBAAoB,CAAC,uBAAuB,EAAE,KAAK,SAAS,EAAE;wBAChE;oBACF,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,uCAAuC;oBACvD;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,iCAAiC;gBAE/C,kDAAkD;gBAClD,yBAAyB,GAAG,gBAAgB,SAAS,CAAC;gBACtD,mBAAmB,0BAA0B;YAC/C,SAAU;gBACR,uBAAuB;gBACvB,oBAAoB;YACtB;QACF;QAEA,4DAA4D;QAC5D,MAAM,YAAY,WAAW,mBAAmB;QAChD,OAAO,IAAM,aAAa;IAC5B,GAAG;QAAC;QAAiB;QAAgB;KAAc;IAEnD,oDAAoD;IACpD,MAAM,gBAAgB,CAAC,SAAS,WAAW,GAAG;QAC5C,OAAO,IAAI,QAAQ,CAAC;YAClB,MAAM,MAAM,IAAI;YAChB,IAAI,MAAM,GAAG;gBACX,sCAAsC;gBACtC,MAAM,SAAS,SAAS,aAAa,CAAC;gBACtC,MAAM,MAAM,OAAO,UAAU,CAAC;gBAE9B,2BAA2B;gBAC3B,IAAI,QAAQ,IAAI,KAAK;gBACrB,IAAI,SAAS,IAAI,MAAM;gBAEvB,IAAI,QAAQ,UAAU;oBACpB,SAAS,AAAC,SAAS,WAAY;oBAC/B,QAAQ;gBACV;gBAEA,OAAO,KAAK,GAAG;gBACf,OAAO,MAAM,GAAG;gBAEhB,6CAA6C;gBAC7C,IAAI,SAAS,CAAC,KAAK,GAAG,GAAG,OAAO;gBAChC,QAAQ,OAAO,SAAS,CAAC,cAAc;YACzC;YACA,IAAI,GAAG,GAAG;QACZ;IACF;IAEA,kCAAkC;IAClC,MAAM,oBAAoB;QACxB,IAAI,YAAY;QAChB,IAAI,YAAY;QAEhB,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,MAAM,EAAE,IAAK;YAC5C,MAAM,MAAM,aAAa,GAAG,CAAC;YAC7B,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,MAAM,OAAO,CAAC,IAAI,MAAM,GAAG,MAAM,MAAM,IAAI,GAAG,qCAAqC;YACnF,aAAa;YACb;YACA,QAAQ,GAAG,CAAC,CAAC,MAAM,EAAE,IAAI,QAAQ,EAAE,CAAC,OAAO,IAAI,EAAE,OAAO,CAAC,GAAG,EAAE,CAAC;QACjE;QAEA,QAAQ,GAAG,CAAC,CAAC,0BAA0B,EAAE,CAAC,YAAY,OAAO,IAAI,EAAE,OAAO,CAAC,GAAG,WAAW,EAAE,WAAW;QACtG,OAAO;IACT;IAEA,MAAM,oBAAoB;QACxB,wBAAwB;IAC1B;IAEA,MAAM,mBAAmB;QACvB,wBAAwB;QACxB,mBAAmB;QACnB,kBAAkB;QAClB,sBAAsB;QACtB,mBAAmB;QACnB,gBAAgB;QAChB,oBAAoB;QACpB,oBAAoB;IACtB;IAEA,mDAAmD;IACnD,MAAM,0BAA0B,CAAC;QAC/B,uEAAuE;QACvE,IAAI,EAAE,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,kBAAkB;YAChD;QACF;IACF;IAEA,MAAM,mBAAmB,CAAC;QACxB,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE;QAC9B,IAAI,CAAC,MAAM;QAEX,IAAI,CAAC,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;YACnC,MAAM;YACN;QACF;QAEA,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG;YACd,6EAA6E;YAC7E,MAAM,MAAM,IAAI;YAChB,IAAI,MAAM,GAAG;gBACX,wDAAwD;gBACxD,MAAM,SAAS,SAAS,aAAa,CAAC;gBACtC,6DAA6D;gBAC7D,MAAM,OAAO,KAAK,GAAG,CAAC,IAAI,KAAK,EAAE,IAAI,MAAM;gBAC3C,OAAO,KAAK,GAAG;gBACf,OAAO,MAAM,GAAG;gBAEhB,6DAA6D;gBAC7D,MAAM,UAAU,CAAC,IAAI,KAAK,GAAG,IAAI,IAAI;gBACrC,MAAM,UAAU,CAAC,IAAI,MAAM,GAAG,IAAI,IAAI;gBAEtC,uCAAuC;gBACvC,MAAM,MAAM,OAAO,UAAU,CAAC;gBAC9B,IAAI,SAAS,CAAC,KAAK,SAAS,SAAS,MAAM,MAAM,GAAG,GAAG,MAAM;gBAE7D,mCAAmC;gBACnC,MAAM,sBAAsB,OAAO,SAAS,CAAC,KAAK,IAAI;gBACtD,sBAAsB;gBACtB,mBAAmB;YACrB;YACA,IAAI,GAAG,GAAG,OAAO,MAAM;QACzB;QACA,OAAO,aAAa,CAAC;IACvB;IAEA,MAAM,mBAAmB;QACvB,aAAa,OAAO,CAAC,KAAK;IAC5B;IAEA,MAAM,8BAA8B;QAClC,IAAI,CAAC,gBAAgB,IAAI,IAAI;QAE7B,iDAAiD;QACjD,MAAM,gBAAgB,0BAA0B;QAChD,gBAAgB;QAEhB,8DAA8D;QAC9D,oBAAoB;IACtB;IAEA,iDAAiD;IACjD,MAAM,oBAAoB,CAAC;QACzB,OAAO,IAAI,QAAQ,CAAC,SAAS;YAC3B,MAAM,SAAS,IAAI;YACnB,OAAO,MAAM,GAAG,IAAM,QAAQ,OAAO,MAAM;YAC3C,OAAO,OAAO,GAAG;YACjB,OAAO,aAAa,CAAC;QACvB;IACF;IAEA,6EAA6E;IAC7E,MAAM,0BAA0B,OAAO;QACrC,sCAAsC;QACtC,MAAM,WAAW,KAAK,yBAAyB;QAC/C,MAAM,UAAU,KAAK,iCAAiC;QAEtD,OAAO,IAAI,QAAQ,CAAC;YAClB,MAAM,MAAM,IAAI;YAChB,IAAI,MAAM,GAAG;gBACX,MAAM,SAAS,SAAS,aAAa,CAAC;gBACtC,MAAM,MAAM,OAAO,UAAU,CAAC;gBAE9B,IAAI,QAAQ,IAAI,KAAK;gBACrB,IAAI,SAAS,IAAI,MAAM;gBAEvB,IAAI,QAAQ,UAAU;oBACpB,SAAS,AAAC,SAAS,WAAY;oBAC/B,QAAQ;gBACV;gBAEA,OAAO,KAAK,GAAG;gBACf,OAAO,MAAM,GAAG;gBAEhB,IAAI,SAAS,CAAC,KAAK,GAAG,GAAG,OAAO;gBAChC,QAAQ,OAAO,SAAS,CAAC,cAAc;YACzC;YACA,IAAI,GAAG,GAAG;QACZ;IACF;IAEA,kDAAkD;IAClD,MAAM,qBAAqB,OAAO;QAChC,IAAI;YACF,wBAAwB;YACxB,MAAM,iBAAiB,aAAa,OAAO,CAAC;YAC5C,IAAI,CAAC,gBAAgB;YAErB,MAAM,kBAAkB,KAAK,KAAK,CAAC;YACnC,MAAM,aAAa,OAAO,IAAI,CAAC,iBAAiB,MAAM,CAAC,CAAA,MACrD,CAAC,OAAO,IAAI,CAAC,qBAAqB,QAAQ,CAAC;YAE7C,+DAA+D;YAC/D,IAAI,WAAW,MAAM,GAAG,GAAG;gBACzB,4EAA4E;gBAC5E,MAAM,eAAe,WAAW,KAAK,CAAC,GAAG,WAAW,MAAM,GAAG;gBAE7D,aAAa,OAAO,CAAC,CAAA;oBACnB,OAAO,eAAe,CAAC,IAAI;gBAC7B;gBAEA,4CAA4C;gBAC5C,aAAa,OAAO,CAAC,mBAAmB,KAAK,SAAS,CAAC;YACzD;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iCAAiC;QACjD;IACF;IAEA,0CAA0C;IAC1C,MAAM,oBAAoB;QACxB,mBAAmB;QACnB,yBAAyB;QACzB,mBAAmB;QACnB,gBAAgB;QAChB,oBAAoB;QACpB,kBAAkB;QAClB,sBAAsB;QACtB,oBAAoB;IACtB;IAEA,iEAAiE;IACjE,MAAM,uBAAuB;QAC3B;QACA,iBAAiB;QACjB,wBAAwB;IAC1B;IAEA,2DAA2D;IAC3D,MAAM,qBAAqB,CAAC;QAC1B,MAAM,WAAW,SAAS,CAAC,WAAW;QACtC,IAAI,CAAC,UAAU;QAEf,qCAAqC;QACrC,mBAAmB,SAAS,mBAAmB,IAAI,KAAK,0CAA0C;QAClG,yBAAyB,SAAS,IAAI,IAAI;QAE1C,uCAAuC;QACvC,MAAM,iBAAiB,SAAS,MAAM,IAAI;QAC1C,mBAAmB;QACnB,gBAAgB;QAChB,oBAAoB;QAEpB,gDAAgD;QAChD,IAAI,SAAS,SAAS,EAAE;YACtB,oBAAoB,SAAS,SAAS;YACtC,kBAAkB;QACpB;QAEA,iBAAiB;QACjB,wBAAwB;IAC1B;IAEA,mDAAmD;IACnD,MAAM,yBAAyB,OAAO;QACpC,IAAI,CAAC,gBAAgB,IAAI,MAAM,gBAAgB;QAE/C,uBAAuB;QAEvB,IAAI;YACF,oDAAoD;YACpD,MAAM,cAAc,oBAAoB,aAAa,IAAI,KACrD,eACA,0BAA0B;YAE9B,yCAAyC;YACzC,MAAM,WAAW,MAAM,MAAM,iBAAiB;gBAC5C,QAAQ;gBACR,SAAS;oBACP,gBAAgB;gBAClB;gBACA,MAAM,KAAK,SAAS,CAAC;oBACnB,QAAQ;gBACV;YACF;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,IAAI,KAAK,OAAO,IAAI,KAAK,SAAS,EAAE;gBAClC,4BAA4B;gBAC5B,oBAAoB,CAAC,uBAAuB,EAAE,KAAK,SAAS,EAAE;YAChE;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,uCAAuC;QACvD,SAAU;YACR,uBAAuB;QACzB;IACF;IAEA,8CAA8C;IAC9C,MAAM,oBAAoB;QACxB,IAAI,CAAC,gBAAgB,IAAI,IAAI;QAE7B,oBAAoB;QAEpB,IAAI;QACF,4CAA4C;QAC5C,kDAAkD;QACpD,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,8CAA8C;QAC9D,SAAU;YACR,oBAAoB;QACtB;IACF;IAEA,MAAM,+BAA+B,OAAO;QAC1C,IAAI,CAAC,YAAY,IAAI,IAAI;QAEzB,oBAAoB;QACpB,IAAI;YACF,MAAM,WAAW,MAAM,uBAAuB;YAC9C,yBAAyB,SAAS,IAAI;YACtC,mBAAmB,SAAS,MAAM;YAElC,mDAAmD;YACnD,IAAI,CAAC,gBAAgB;gBACnB,uBAAuB,SAAS,MAAM;YACxC;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,8BAA8B;QAC9C,SAAU;YACR,oBAAoB;QACtB;IACF;IAEA,MAAM,uBAAuB;QAC3B,IAAI,CAAC,gBAAgB,IAAI,IAAI;QAE7B,wCAAwC;QACxC,MAAM,aAAa,iBAAiB,CAAC,OAAO,EAAE,KAAK,GAAG,IAAI;QAE1D,6DAA6D;QAC7D,MAAM,cAAc,yBAAyB,GAAG,gBAAgB,SAAS,CAAC;QAE1E,qCAAqC;QACrC,MAAM,iBAAiB,mBAAmB,eAAgB,mBAAmB,0BAA0B;QAEvG,iCAAiC;QACjC,MAAM,cAAc;YAClB,MAAM;YACN,QAAQ;YACR,WAAW,iBAAiB,qBAAqB;YACjD,qBAAqB;YACrB,UAAU;QACZ;QAEA,+CAA+C;QAC/C,MAAM,mBAAmB;YAAE,GAAG,SAAS;YAAE,CAAC,WAAW,EAAE;QAAY;QAEnE,mDAAmD;QACnD,IAAI,kBAAkB,oBAAoB;YACxC,YAAY,SAAS,GAAG,MAAM,wBAAwB;QACxD,OAAO,IAAI,kBAAkB;YAC3B,YAAY,SAAS,GAAG,MAAM,wBAAwB;QACxD;QAEA,8CAA8C;QAC9C,MAAM,mBAAmB;QAEzB,IAAI;YACF,uBAAuB;YACvB,aAAa,OAAO,CAAC,mBAAmB,KAAK,SAAS,CAAC;YAEvD,oCAAoC;YACpC,eAAe;YACf,aAAa;YAEb,6CAA6C;YAC7C,iBAAiB;YAEjB,kCAAkC;YAClC,aAAa;YAEb,kBAAkB;YAClB,wBAAwB;YAExB,aAAa;YACb;YAEA,QAAQ,GAAG,CAAC,kCAAkC;QAChD,EAAE,OAAO,OAAO;YACd,mDAAmD;YACnD,QAAQ,KAAK,CAAC,kBAAkB;YAEhC,iDAAiD;YACjD,MAAM,mBAAmB,CAAC;YAE1B,kDAAkD;YAClD,gBAAgB,CAAC,WAAW,GAAG;YAE/B,4BAA4B;YAC5B,IAAI;gBACF,aAAa,OAAO,CAAC,mBAAmB,KAAK,SAAS,CAAC;gBACvD,eAAe;oBAAC,GAAG,mBAAmB;oBAAE,GAAG,gBAAgB;gBAAA;gBAC3D,aAAa;YACf,EAAE,OAAO,aAAa;gBACpB,qCAAqC;gBACrC,MAAM;YACR;QACF;IACF;IAEA,MAAM,uBAAuB,CAAC,OAAO;QACnC,MAAM,eAAe,IAAI,iDAAiD;QAE1E,uCAAuC;QACvC,IAAI,YAAY,CAAC,IAAI,EAAE,UAAU;YAC/B,IAAI,OAAO,OAAO,CAAC,CAAC,qCAAqC,EAAE,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG;gBAC/F,oDAAoD;gBACpD,IAAI,cAAc,KAAK;oBACrB,aAAa;gBACf;gBAEA,sBAAsB;gBACtB,MAAM,EAAE,CAAC,IAAI,EAAE,OAAO,EAAE,GAAG,WAAW,GAAG;gBACzC,MAAM,mBAAmB;oBAAE,GAAG,mBAAmB;oBAAE,GAAG,SAAS;gBAAC;gBAChE,eAAe;gBACf,aAAa;gBAEb,6BAA6B;gBAC7B,MAAM,kBAAkB,CAAC;gBACzB,OAAO,OAAO,CAAC,WAAW,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE;oBACvC,IAAI,CAAC,mBAAmB,CAAC,EAAE,EAAE;wBAC3B,eAAe,CAAC,EAAE,GAAG;oBACvB;gBACF;gBACA,aAAa,OAAO,CAAC,mBAAmB,KAAK,SAAS,CAAC;YACzD;QACF;IACF;IAEA,wDAAwD;IACxD,MAAM,qBAAqB,CAAC;QAC1B,sDAAsD;QACtD,MAAM,oBAAoB,OAAO,OAAO,CAAC,qBACtC,MAAM,CAAC,CAAC,CAAC,IAAI,GAAK,QAAQ,gBAC1B,MAAM,CAAC,CAAC,KAAK,CAAC,KAAK,MAAM,GAAK,CAAC;gBAAE,GAAG,GAAG;gBAAE,CAAC,IAAI,EAAE;YAAM,CAAC,GAAG,CAAC;QAE9D,kEAAkE;QAClE,MAAM,kBAAkB,OAAO,OAAO,CAAC,WACpC,MAAM,CAAC,CAAC,CAAC,IAAI,GAAK,CAAC,mBAAmB,CAAC,IAAI,IAAI,QAAQ,gBACvD,MAAM,CAAC,CAAC,KAAK,CAAC,KAAK,MAAM,GAAK,CAAC;gBAAE,GAAG,GAAG;gBAAE,CAAC,IAAI,EAAE;YAAM,CAAC,GAAG,CAAC;QAE9D,uBAAuB;QACvB,MAAM,eAAe,UAAU,YAAY,GAAG;YAAE,cAAc,UAAU,YAAY;QAAC,IAAI,CAAC;QAE1F,2BAA2B;QAC3B,OAAO;YACL,GAAG,iBAAiB;YACpB,GAAG,eAAe;YAClB,GAAG,YAAY;QACjB;IACF;IAEA,0CAA0C;IAC1C,MAAM,6BAA6B,OAAO;QACxC,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QAChC,IAAI,CAAC,MAAM;QAEX,uDAAuD;QACvD,iBAAiB;QAEjB,qBAAqB;QACrB,oBAAoB;QACpB,uBAAuB;QAEvB,IAAI;YACF,gCAAgC;YAChC,MAAM,SAAS,IAAI;YACnB,OAAO,SAAS,GAAG,OAAO;gBACxB,MAAM,eAAe,MAAM,MAAM,CAAC,MAAM;gBAExC,yBAAyB;gBACzB,sBAAsB;gBACtB,kBAAkB;gBAElB,6BAA6B;gBAC7B,IAAI;oBACF,MAAM,WAAW,MAAM,MAAM,sBAAsB;wBACjD,QAAQ;wBACR,SAAS;4BACP,gBAAgB;wBAClB;wBACA,MAAM,KAAK,SAAS,CAAC;4BAAE,OAAO;wBAAa;oBAC7C;oBAEA,IAAI,CAAC,SAAS,EAAE,EAAE;wBAChB,MAAM,IAAI,MAAM,CAAC,aAAa,EAAE,SAAS,MAAM,EAAE;oBACnD;oBAEA,MAAM,OAAO,MAAM,SAAS,IAAI;oBAEhC,IAAI,KAAK,MAAM,IAAI,KAAK,aAAa,EAAE;wBACrC,kCAAkC;wBAClC,yBAAyB,KAAK,aAAa;wBAC3C,mBAAmB,KAAK,aAAa;wBACrC,mBAAmB,KAAK,MAAM;wBAC9B,gBAAgB,KAAK,MAAM;wBAC3B,oBAAoB;oBACtB;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,oCAAoC;oBAClD,sBAAsB;oBACtB,yBAAyB;oBACzB,mBAAmB;oBACnB,mBAAmB;oBACnB,gBAAgB;gBAClB,SAAU;oBACR,oBAAoB;oBACpB,uBAAuB;gBACzB;YACF;YAEA,OAAO,aAAa,CAAC;QACvB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;YACzC,oBAAoB;YACpB,uBAAuB;QACzB;IACF;IAEA,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAI,WAAU;0BACb,cAAA,qKAAC;oBAAI,WAAU;;wBAEZ,OAAO,OAAO,CAAC,mBAAmB,YAAY,GAAG,CAAC,CAAC,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,iBACvG,qKAAC;gCAEC,SAAS;oCACP,MAAM,iBAAiB,cAAc;oCACrC,IAAI,CAAC,gBAAgB;wCACnB,aAAa;oCACf,OAAO;wCACL;oCACF;gCACF;gCACA,MAAK;gCACL,cAAY,CAAC,OAAO,EAAE,KAAK,MAAM,CAAC;gCAClC,gBAAc,cAAc;gCAC5B,WAAU;0CAEV,cAAA,qKAAC;oCAAI,WAAW,CAAC,YAAY,EAC3B,QAAQ,iBACJ,cAAc,MAAM,oBAAoB,kCACxC,cAAc,MAAM,oBAAoB,kBAC7C,4BAA4B,EAC3B,cAAc,MACV,aACA,cACJ;;sDAEA,qKAAC;4CAAI,WAAU;4CAAkB,OAAO;gDAAE,aAAa;4CAAM;;gDAC1D,QAAQ,+BACP,qKAAC;oDAAI,WAAU;8DACb,cAAA,qKAAC,2MAAA,CAAA,aAAU;wDAAC,WAAU;;;;;;;;;;yEAGxB,qKAAC;oDACC,KAAK,YAAY,CAAC,uBAAuB,EAAE,WAAW,GAAI,OAAO,CAAC,SAAS,EAAE,MAAM,GAAG,aAAa;oDACnG,KAAK,GAAG,KAAK,cAAc,CAAC;oDAC5B,WAAU;oDACV,SAAS,CAAC;wDACR,QAAQ,KAAK,CAAC,CAAC,4BAA4B,EAAE,MAAM;wDACnD,EAAE,MAAM,CAAC,GAAG,GAAG;oDACjB;;;;;;gDAIH,0BACC,qKAAC;oDAAI,WAAU;8DACb,cAAA,qKAAC;wDAAI,WAAU;;0EACb,qKAAC;gEACC,SAAS,CAAC;oEACR,EAAE,cAAc;oEAChB,EAAE,eAAe;oEACjB,mBAAmB;gEACrB;gEACA,WAAU;gEACV,cAAY,CAAC,KAAK,EAAE,KAAK,SAAS,CAAC;0EAEnC,cAAA,qKAAC,oMAAA,CAAA,OAAI;oEAAC,WAAU;;;;;;;;;;;0EAElB,qKAAC;gEACC,SAAS,CAAC;oEACR,EAAE,cAAc;oEAChB,EAAE,eAAe;oEACjB,qBAAqB,GAAG;gEAC1B;gEACA,WAAU;gEACV,cAAY,CAAC,OAAO,EAAE,KAAK,SAAS,CAAC;0EAErC,cAAA,qKAAC,mMAAA,CAAA,SAAM;oEAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;sDAO5B,qKAAC;4CAAI,WAAW,CAAC,iEAAiE,EAChF,cAAc,MACV,6BACA,0BACJ;sDACA,cAAA,qKAAC;gDAAI,WAAU;0DACZ;;;;;;;;;;;;;;;;;+BA7EF;;;;;sCAqFT,qKAAC;4BACC,SAAS;4BACT,MAAK;4BACL,cAAW;4BACX,WAAU;sCAEV,cAAA,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAI,WAAU;wCAAkB,OAAO;4CAAE,aAAa;wCAAM;kDAC3D,cAAA,qKAAC;4CAAI,WAAU;sDACb,cAAA,qKAAC,2LAAA,CAAA,OAAI;gDAAC,WAAU;;;;;;;;;;;;;;;;kDAGpB,qKAAC;wCAAI,WAAU;kDACb,cAAA,qKAAC;4CAAI,WAAU;sDAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAUnC,sCACC,qKAAC;gBACC,WAAU;gBACV,SAAS;0BAET,cAAA,qKAAC;oBACC,WAAU;oBACV,SAAS,CAAC,IAAM,EAAE,eAAe;;sCAEjC,qKAAC;4BAAI,WAAU;sCACb,cAAA,qKAAC;gCAAG,WAAU;0CAAgC;;;;;;;;;;;sCAIhD,qKAAC;4BAAI,WAAU;;8CAEb,qKAAC;oCAAI,WAAU;;sDAEb,qKAAC;4CAAI,WAAU;;8DACb,qKAAC;oDAAM,WAAU;8DAAkC;;;;;;8DACnD,qKAAC;oDACC,MAAK;oDACL,OAAO;oDACP,UAAU,CAAC,IAAM,mBAAmB,EAAE,MAAM,CAAC,KAAK;oDAClD,WAAU;oDACV,aAAY;;;;;;;;;;;;sDAKhB,qKAAC;sDACC,cAAA,qKAAC;gDAAI,WAAU;;oDACX,oBAAoB,mCACpB,qKAAC;wDACC,KAAK,iBAAiB,qBAAqB;wDAC3C,KAAI;wDACJ,WAAU;;;;;6EAGZ,qKAAC;wDAAI,WAAU;kEACb,cAAA,qKAAC;4DAAE,WAAU;sEACV,sBAAsB,kBAAkB;;;;;;;;;;;oDAI9C,qCACC,qKAAC;wDAAI,WAAU;kEACb,cAAA,qKAAC;4DAAI,WAAU;sEACb,cAAA,qKAAC,yMAAA,CAAA,YAAS;gEAAC,WAAU;;;;;;;;;;;;;;;;oDAM1B,CAAC,oBAAoB,kBAAkB,KAAK,CAAC,uBAAuB,CAAC,gCACpE,qKAAC;wDACC,SAAS,IAAM,uBAAuB;wDACtC,WAAU;wDACV,OAAM;kEAEN,cAAA,qKAAC,2MAAA,CAAA,aAAU;4DAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;8CAQhC,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAM,WAAU;sDAAkC;;;;;;sDACnD,qKAAC;4CACC,WAAU;4CACV,SAAS,IAAM,aAAa,OAAO,EAAE;4CACrC,OAAO;gDAAE,QAAQ;4CAAQ;;8DAEzB,qKAAC;oDAAI,WAAU;;sEACb,qKAAC,+LAAA,CAAA,SAAM;4DAAC,WAAU;;;;;;sEAClB,qKAAC;4DAAE,WAAU;sEAAgB;;;;;;;;;;;;8DAE/B,qKAAC;oDACC,KAAK;oDACL,MAAK;oDACL,QAAO;oDACP,WAAU;oDACV,UAAU;;;;;;;;;;;;;;;;;;;;;;;;sCAOlB,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAM,WAAU;sDAA+B;;;;;;wCAG/C,CAAC,sCACA,qKAAC;4CACC,SAAS,IAAM,wBAAwB;4CACvC,WAAU;4CACV,OAAM;sDAEN,cAAA,qKAAC,oMAAA,CAAA,OAAI;gDAAC,WAAU;;;;;;;;;;;;;;;;;8CAItB,qKAAC;oCAAI,WAAU;;wCACZ,qCACC,qKAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,yBAAyB,EAAE,MAAM,CAAC,KAAK;4CACxD,WAAU;4CACV,aAAY;;;;;iEAGd,qKAAC;4CAAI,WAAU;sDACZ,yBAAyB;;;;;;wCAG7B,kCACC,qKAAC;4CAAI,WAAU;sDACb,cAAA,qKAAC,yMAAA,CAAA,YAAS;gDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;sCAO7B,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAM,WAAU;sDAA+B;;;;;;wCAG/C,CAAC,kCACA,qKAAC;4CACC,SAAS,IAAM,oBAAoB;4CACnC,WAAU;4CACV,OAAM;sDAEN,cAAA,qKAAC,oMAAA,CAAA,OAAI;gDAAC,WAAU;;;;;;;;;;;;;;;;;8CAKtB,qKAAC;oCAAI,WAAU;;wCACZ,iCACC;;8DACE,qKAAC;oDACC,OAAO;oDACP,UAAU,CAAC,IAAM,gBAAgB,EAAE,MAAM,CAAC,KAAK;oDAC/C,WAAU;oDACV,aAAY;;;;;;8DAEd,qKAAC;oDAAI,WAAU;8DACb,cAAA,qKAAC;wDACC,MAAK;wDACL,SAAS;4DACP,gBAAgB;4DAChB,oBAAoB;wDACtB;wDACA,WAAU;kEACX;;;;;;;;;;;;yEAML,qKAAC;4CAAI,WAAU;sDACZ,mBAAmB;;;;;;wCAGvB,kCACC,qKAAC;4CAAI,WAAU;sDACb,cAAA,qKAAC,yMAAA,CAAA,YAAS;gDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;sCAM7B,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCACC,SAAS,IAAM,wBAAwB;oCACvC,WAAU;8CACX;;;;;;8CAGD,qKAAC;oCACC,SAAS;oCACT,UAAU,yBAAyB,CAAC,gBAAgB,IAAI;oCACxD,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASf;uCAEe","debugId":null}},
    {"offset": {"line": 2890, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/ErrorModal.js"],"sourcesContent":["import { X } from 'lucide-react';\n\nconst ErrorModal = ({ \n  showErrorModal, \n  closeErrorModal, \n  customApiKey, \n  setCustomApiKey, \n  handleApiKeySubmit \n}) => {\n  return (\n    <>\n      {showErrorModal && (\n        <div className=\"fixed inset-0 bg-black/30 flex items-center justify-center z-50\">\n          <div className=\"bg-white p-6 rounded-xl shadow-medium max-w-md w-full mx-4\">\n            <div className=\"flex flex-col gap-4\">\n              <div className=\"flex items-center justify-between\">\n                <h2 className=\"text-xl font-medium text-gray-800\">API Quota Exceeded</h2>\n                <button \n                  type=\"button\"\n                  onClick={closeErrorModal}\n                  className=\"text-gray-500 hover:text-gray-700\"\n                  aria-label=\"Close\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n              \n              <div className=\"text-gray-600\">\n                <p className=\"mb-2\">\n                  You've exceeded your API quota. You can:\n                </p>\n                <ul className=\"list-disc ml-5 mb-4 space-y-1 text-gray-600\">\n                  <li>Wait for your quota to reset</li>\n                  <li>Use your own API key</li>\n                </ul>\n              </div>\n              \n              <form onSubmit={handleApiKeySubmit} className=\"space-y-3\">\n                <div>\n                  <label \n                    htmlFor=\"apiKey\" \n                    className=\"block text-sm font-medium text-gray-700 mb-1\"\n                  >\n                    Your Gemini API Key\n                  </label>\n                  <input\n                    id=\"apiKey\"\n                    type=\"password\"\n                    placeholder=\"Enter your Gemini API key\"\n                    value={customApiKey}\n                    onChange={(e) => setCustomApiKey(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent\"\n                  />\n                </div>\n                <div className=\"flex justify-end gap-3 pt-2\">\n                  <button\n                    type=\"button\"\n                    onClick={closeErrorModal}\n                    className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors\"\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    type=\"submit\"\n                    className=\"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors\"\n                  >\n                    Use My Key\n                  </button>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default ErrorModal; "],"names":[],"mappings":";;;;AAAA;;;AAEA,MAAM,aAAa,CAAC,EAClB,cAAc,EACd,eAAe,EACf,YAAY,EACZ,eAAe,EACf,kBAAkB,EACnB;IACC,qBACE;kBACG,gCACC,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAI,WAAU;0BACb,cAAA,qKAAC;oBAAI,WAAU;;sCACb,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAG,WAAU;8CAAoC;;;;;;8CAClD,qKAAC;oCACC,MAAK;oCACL,SAAS;oCACT,WAAU;oCACV,cAAW;8CAEX,cAAA,qKAAC,qLAAA,CAAA,IAAC;wCAAC,WAAU;;;;;;;;;;;;;;;;;sCAIjB,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAE,WAAU;8CAAO;;;;;;8CAGpB,qKAAC;oCAAG,WAAU;;sDACZ,qKAAC;sDAAG;;;;;;sDACJ,qKAAC;sDAAG;;;;;;;;;;;;;;;;;;sCAIR,qKAAC;4BAAK,UAAU;4BAAoB,WAAU;;8CAC5C,qKAAC;;sDACC,qKAAC;4CACC,SAAQ;4CACR,WAAU;sDACX;;;;;;sDAGD,qKAAC;4CACC,IAAG;4CACH,MAAK;4CACL,aAAY;4CACZ,OAAO;4CACP,UAAU,CAAC,IAAM,gBAAgB,EAAE,MAAM,CAAC,KAAK;4CAC/C,WAAU;;;;;;;;;;;;8CAGd,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CACC,MAAK;4CACL,SAAS;4CACT,WAAU;sDACX;;;;;;sDAGD,qKAAC;4CACC,MAAK;4CACL,WAAU;sDACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWnB;uCAEe","debugId":null}},
    {"offset": {"line": 3072, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/TextInput.js"],"sourcesContent":["import { useEffect, useRef } from 'react';\n\nconst TextInput = ({ \n  isTyping, \n  textInputRef, \n  textInput, \n  setTextInput, \n  handleTextInput, \n  textPosition \n}) => {\n  if (!isTyping) {\n    return null;\n  }\n  \n  return (\n    <div\n      className=\"absolute z-50 bg-white border border-gray-300 rounded-lg shadow-medium p-2\"\n      style={{\n        top: textPosition.y,\n        left: textPosition.x,\n        transform: 'translateY(-100%)'\n      }}\n    >\n      <input\n        ref={textInputRef}\n        type=\"text\"\n        value={textInput}\n        onChange={(e) => setTextInput(e.target.value)}\n        onKeyDown={handleTextInput}\n        placeholder=\"Type text...\"\n        className=\"w-full p-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-400\"\n        aria-label=\"Text input for canvas\"\n      />\n    </div>\n  );\n};\n\nexport default TextInput; "],"names":[],"mappings":";;;;AAAA;;;AAEA,MAAM,YAAY,CAAC,EACjB,QAAQ,EACR,YAAY,EACZ,SAAS,EACT,YAAY,EACZ,eAAe,EACf,YAAY,EACb;IACC,IAAI,CAAC,UAAU;QACb,OAAO;IACT;IAEA,qBACE,qKAAC;QACC,WAAU;QACV,OAAO;YACL,KAAK,aAAa,CAAC;YACnB,MAAM,aAAa,CAAC;YACpB,WAAW;QACb;kBAEA,cAAA,qKAAC;YACC,KAAK;YACL,MAAK;YACL,OAAO;YACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;YAC5C,WAAW;YACX,aAAY;YACZ,WAAU;YACV,cAAW;;;;;;;;;;;AAInB;uCAEe","debugId":null}},
    {"offset": {"line": 3117, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/Header.js"],"sourcesContent":["const Header = () => {\n  return (\n    <header className=\"w-full flex items-center\">\n      <div className=\"flex flex-col items-start\">\n        <h1 className=\"text-lg font-medium tracking-[-0.2px] text-gray-800\" style={{ fontFamily: \"'Google Sans Text', sans-serif\" }}>GEMINI 3D</h1>\n        \n        <p className=\"text-gray-400\">\n          <span>By</span>{\" \"}\n          <a href=\"https://x.com/dev_valladares\" className=\"hover:text-gray-600 transition-colors\">Dev Valladares</a> \n          {\" \"}&{\" \"}\n          <a href=\"https://x.com/trudypainter\" className=\"hover:text-gray-600 transition-colors\">Trudy Painter</a>\n          {\" \"} <a \n            href=\"https://aistudio.google.com/prompts/new_chat\" \n            className=\"hover:text-gray-600 transition-colors\"\n            target=\"_blank\" \n            rel=\"noopener noreferrer\"\n          >\n            Google Creative Lab\n          </a>\n        </p>\n      </div>\n    </header>\n  );\n};\n\nexport default Header; "],"names":[],"mappings":";;;;;AAAA,MAAM,SAAS;IACb,qBACE,qKAAC;QAAO,WAAU;kBAChB,cAAA,qKAAC;YAAI,WAAU;;8BACb,qKAAC;oBAAG,WAAU;oBAAsD,OAAO;wBAAE,YAAY;oBAAiC;8BAAG;;;;;;8BAE7H,qKAAC;oBAAE,WAAU;;sCACX,qKAAC;sCAAK;;;;;;wBAAU;sCAChB,qKAAC;4BAAE,MAAK;4BAA+B,WAAU;sCAAwC;;;;;;wBACxF;wBAAI;wBAAE;sCACP,qKAAC;4BAAE,MAAK;4BAA6B,WAAU;sCAAwC;;;;;;wBACtF;wBAAI;sCAAE,qKAAC;4BACN,MAAK;4BACL,WAAU;4BACV,QAAO;4BACP,KAAI;sCACL;;;;;;;;;;;;;;;;;;;;;;;AAOX;uCAEe","debugId":null}},
    {"offset": {"line": 3209, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/DimensionSelector.js"],"sourcesContent":["import { Square, RectangleVertical, RectangleHorizontal, ChevronDown } from 'lucide-react';\nimport { useState, useEffect, useRef } from 'react';\n\nconst dimensions = [\n  {\n    id: 'landscape',\n    label: '3:2',\n    width: 1500,\n    height: 1000,\n    icon: RectangleHorizontal\n  },\n  {\n    id: 'portrait',\n    label: '4:5',\n    width: 1000,\n    height: 1250,\n    icon: RectangleVertical\n  },\n  {\n    id: 'square',\n    label: '1:1',\n    width: 1000,\n    height: 1000,\n    icon: Square\n  }\n];\n\nconst DimensionSelector = ({ currentDimension = dimensions[0], onDimensionChange }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const dropdownRef = useRef(null);\n  \n  // Replace click handlers with hover handlers\n  const handleMouseEnter = () => setIsOpen(true);\n  const handleMouseLeave = () => setIsOpen(false);\n\n  return (\n    <div \n      className=\"relative z-50\" \n      ref={dropdownRef}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n    >\n      {/* Current selection - removed ChevronDown */}\n      <button\n        className=\"flex items-center gap-2 border border-gray-200 px-4 py-2 rounded-full transition-all hover:bg-gray-50 hover:border-gray-300\"\n        style={{ opacity: isOpen ? 1 : 0.7 }}\n      >\n        {(() => {\n          const current = dimensions.find(d => d.id === currentDimension.id) || dimensions[0];\n          const Icon = current.icon;\n          return (\n            <>\n              <Icon className=\"w-4 h-4 text-gray-600\" />\n              <span className=\"text-sm text-gray-600\">{current.label}</span>\n            </>\n          );\n        })()}\n      </button>\n\n      {/* Invisible wrapper to bridge the gap + Dropdown */}\n      {isOpen && (\n        <>\n          <div className=\"absolute inset-x-0 h-2 -bottom-2\" />\n          <div className=\"absolute right-0 top-[calc(100%-1px)] bg-white rounded-lg shadow-lg border border-gray-200 z-10\">\n            {dimensions.map((dim) => {\n              const Icon = dim.icon;\n              return (\n                <button\n                  key={dim.id}\n                  onClick={() => onDimensionChange(dim)}\n                  className={`w-full p-2 flex items-center gap-2 hover:bg-gray-50 transition-opacity ${\n                    currentDimension.id === dim.id ? 'opacity-100' : 'opacity-70'\n                  }`}\n                >\n                  <Icon className=\"w-4 h-4 text-gray-600\" />\n                  <span className=\"text-sm text-gray-600 whitespace-nowrap\">{dim.label}</span>\n                </button>\n              );\n            })}\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default DimensionSelector; "],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;AACA;;;;AAEA,MAAM,aAAa;IACjB;QACE,IAAI;QACJ,OAAO;QACP,OAAO;QACP,QAAQ;QACR,MAAM,6NAAA,CAAA,sBAAmB;IAC3B;IACA;QACE,IAAI;QACJ,OAAO;QACP,OAAO;QACP,QAAQ;QACR,MAAM,yNAAA,CAAA,oBAAiB;IACzB;IACA;QACE,IAAI;QACJ,OAAO;QACP,OAAO;QACP,QAAQ;QACR,MAAM,+LAAA,CAAA,SAAM;IACd;CACD;AAED,MAAM,oBAAoB,CAAC,EAAE,mBAAmB,UAAU,CAAC,EAAE,EAAE,iBAAiB,EAAE;IAChF,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,mGAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,cAAc,CAAA,GAAA,mGAAA,CAAA,SAAM,AAAD,EAAE;IAE3B,6CAA6C;IAC7C,MAAM,mBAAmB,IAAM,UAAU;IACzC,MAAM,mBAAmB,IAAM,UAAU;IAEzC,qBACE,qKAAC;QACC,WAAU;QACV,KAAK;QACL,cAAc;QACd,cAAc;;0BAGd,qKAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,SAAS,SAAS,IAAI;gBAAI;0BAElC,CAAC;oBACA,MAAM,UAAU,WAAW,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,iBAAiB,EAAE,KAAK,UAAU,CAAC,EAAE;oBACnF,MAAM,OAAO,QAAQ,IAAI;oBACzB,qBACE;;0CACE,qKAAC;gCAAK,WAAU;;;;;;0CAChB,qKAAC;gCAAK,WAAU;0CAAyB,QAAQ,KAAK;;;;;;;;gBAG5D,CAAC;;;;;;YAIF,wBACC;;kCACE,qKAAC;wBAAI,WAAU;;;;;;kCACf,qKAAC;wBAAI,WAAU;kCACZ,WAAW,GAAG,CAAC,CAAC;4BACf,MAAM,OAAO,IAAI,IAAI;4BACrB,qBACE,qKAAC;gCAEC,SAAS,IAAM,kBAAkB;gCACjC,WAAW,CAAC,uEAAuE,EACjF,iBAAiB,EAAE,KAAK,IAAI,EAAE,GAAG,gBAAgB,cACjD;;kDAEF,qKAAC;wCAAK,WAAU;;;;;;kDAChB,qKAAC;wCAAK,WAAU;kDAA2C,IAAI,KAAK;;;;;;;+BAP/D,IAAI,EAAE;;;;;wBAUjB;;;;;;;;;;;;;;AAMZ;uCAEe","debugId":null}},
    {"offset": {"line": 3348, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/HistoryModal.js"],"sourcesContent":["import { X } from 'lucide-react';\n\nconst HistoryModal = ({ \n  isOpen, \n  onClose, \n  history,\n  onSelectImage,\n  currentDimension\n}) => {\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/30 flex items-center justify-center z-50\">\n      <div className=\"bg-white p-6 rounded-xl shadow-medium max-w-5xl w-full mx-4 max-h-[80vh] flex flex-col\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-xl font-medium text-gray-800\">Drawing History</h2>\n          <button \n            type=\"button\"\n            onClick={onClose}\n            className=\"text-gray-500 hover:text-gray-700\"\n            aria-label=\"Close\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {history.length === 0 ? (\n          <div className=\"flex-1 flex items-center justify-center text-gray-500\">\n            No history available yet. Start drawing to create some!\n          </div>\n        ) : (\n          <div className=\"flex-1 overflow-y-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 p-2\">\n            {history.map((item, index) => (\n              <div \n                key={item.timestamp} \n                className=\"relative group cursor-pointer\"\n                onClick={() => onSelectImage(item)}\n              >\n                <div className=\"aspect-w-3 aspect-h-2 rounded-lg overflow-hidden border border-gray-200\">\n                  <img \n                    src={item.imageUrl} \n                    alt={`Drawing history ${index + 1}`}\n                    className=\"object-cover w-full h-full group-hover:opacity-90 transition-opacity\"\n                  />\n                </div>\n                <div className=\"absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs p-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                  {new Date(item.timestamp).toLocaleString()}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default HistoryModal; "],"names":[],"mappings":";;;;AAAA;;;AAEA,MAAM,eAAe,CAAC,EACpB,MAAM,EACN,OAAO,EACP,OAAO,EACP,aAAa,EACb,gBAAgB,EACjB;IACC,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,qKAAC;QAAI,WAAU;kBACb,cAAA,qKAAC;YAAI,WAAU;;8BACb,qKAAC;oBAAI,WAAU;;sCACb,qKAAC;4BAAG,WAAU;sCAAoC;;;;;;sCAClD,qKAAC;4BACC,MAAK;4BACL,SAAS;4BACT,WAAU;4BACV,cAAW;sCAEX,cAAA,qKAAC,qLAAA,CAAA,IAAC;gCAAC,WAAU;;;;;;;;;;;;;;;;;gBAIhB,QAAQ,MAAM,KAAK,kBAClB,qKAAC;oBAAI,WAAU;8BAAwD;;;;;yCAIvE,qKAAC;oBAAI,WAAU;8BACZ,QAAQ,GAAG,CAAC,CAAC,MAAM,sBAClB,qKAAC;4BAEC,WAAU;4BACV,SAAS,IAAM,cAAc;;8CAE7B,qKAAC;oCAAI,WAAU;8CACb,cAAA,qKAAC;wCACC,KAAK,KAAK,QAAQ;wCAClB,KAAK,CAAC,gBAAgB,EAAE,QAAQ,GAAG;wCACnC,WAAU;;;;;;;;;;;8CAGd,qKAAC;oCAAI,WAAU;8CACZ,IAAI,KAAK,KAAK,SAAS,EAAE,cAAc;;;;;;;2BAZrC,KAAK,SAAS;;;;;;;;;;;;;;;;;;;;;AAqBnC;uCAEe","debugId":null}},
    {"offset": {"line": 3463, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/BottomToolBar.js"],"sourcesContent":["import { Plus, HelpCircle } from 'lucide-react';\n\nconst BottomToolBar = () => {\n  const tools = [\n    { id: 'add', icon: Plus, label: 'Add' },\n    { id: 'help', icon: HelpCircle, label: 'Help' }\n  ];\n\n  return (\n    <div className=\"flex flex-col gap-2 rounded-xl p-2 opacity-0\">\n      {tools.map((tool) => (\n        <div key={tool.id} className=\"relative\">\n          <button\n            className=\"p-2 rounded-lg\"\n            title={tool.label}\n          >\n            <tool.icon className=\"w-5 h-5\" />\n          </button>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default BottomToolBar; "],"names":[],"mappings":";;;;AAAA;AAAA;;;AAEA,MAAM,gBAAgB;IACpB,MAAM,QAAQ;QACZ;YAAE,IAAI;YAAO,MAAM,2LAAA,CAAA,OAAI;YAAE,OAAO;QAAM;QACtC;YAAE,IAAI;YAAQ,MAAM,2MAAA,CAAA,aAAU;YAAE,OAAO;QAAO;KAC/C;IAED,qBACE,qKAAC;QAAI,WAAU;kBACZ,MAAM,GAAG,CAAC,CAAC,qBACV,qKAAC;gBAAkB,WAAU;0BAC3B,cAAA,qKAAC;oBACC,WAAU;oBACV,OAAO,KAAK,KAAK;8BAEjB,cAAA,qKAAC,KAAK,IAAI;wBAAC,WAAU;;;;;;;;;;;eALf,KAAK,EAAE;;;;;;;;;;AAWzB;uCAEe","debugId":null}},
    {"offset": {"line": 3521, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/GalleryButton.js"],"sourcesContent":["import Link from 'next/link';\nimport { Grid } from 'lucide-react';\n\nconst GalleryButton = () => {\n  return (\n    <Link \n      href=\"/gallery\"\n      className=\"flex items-center gap-2 border border-gray-200 px-4 py-2 rounded-full opacity-70 hover:opacity-100 hover:bg-gray-50 hover:border-gray-300 transition-all\"\n    >\n      <Grid className=\"w-4 h-4 text-gray-600\" />\n      <span className=\"text-sm text-gray-600 whitespace-nowrap\">Gallery</span>\n    </Link>\n  );\n};\n\nexport default GalleryButton; "],"names":[],"mappings":";;;;AAAA;AACA;;;;AAEA,MAAM,gBAAgB;IACpB,qBACE,qKAAC,qHAAA,CAAA,UAAI;QACH,MAAK;QACL,WAAU;;0BAEV,qKAAC,kMAAA,CAAA,OAAI;gBAAC,WAAU;;;;;;0BAChB,qKAAC;gBAAK,WAAU;0BAA0C;;;;;;;;;;;;AAGhE;uCAEe","debugId":null}},
    {"offset": {"line": 3564, "column": 0}, "map": {"version":3,"sources":["file:///Users/devvalladares/Documents/GitHub/material-test-3/components/CanvasContainer.js"],"sourcesContent":["import { useState, useRef, useEffect, useCallback } from \"react\";\nimport Canvas from \"./Canvas\";\nimport DisplayCanvas from \"./DisplayCanvas\";\nimport ToolBar from \"./ToolBar\";\nimport StyleSelector from \"./StyleSelector\";\nimport { getPromptForStyle } from \"./StyleSelector\";\nimport ActionBar from \"./ActionBar\";\nimport ErrorModal from \"./ErrorModal\";\nimport TextInput from \"./TextInput\";\nimport Header from \"./Header\";\nimport DimensionSelector from \"./DimensionSelector\";\nimport HistoryModal from \"./HistoryModal\";\nimport BottomToolBar from \"./BottomToolBar\";\nimport GalleryButton from \"./GalleryButton\";\nimport { getCoordinates, initializeCanvas, drawImageToCanvas, drawBezierCurve } from \"./utils/canvasUtils\";\n\nconst CanvasContainer = () => {\n  const canvasRef = useRef(null);\n  const displayCanvasRef = useRef(null);\n  const backgroundImageRef = useRef(null);\n  const [currentDimension, setCurrentDimension] = useState({ \n    id: 'landscape', \n    label: '3:2',\n    width: 1500, \n    height: 1000 \n  });\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [penColor, setPenColor] = useState(\"#000000\");\n  const [penWidth, setPenWidth] = useState(2);\n  const colorInputRef = useRef(null);\n  const [prompt, setPrompt] = useState(\"\");\n  const [generatedImage, setGeneratedImage] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [showErrorModal, setShowErrorModal] = useState(false);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [customApiKey, setCustomApiKey] = useState(\"\");\n  const [styleMode, setStyleMode] = useState('material');\n  const [strokeCount, setStrokeCount] = useState(0);\n  const strokeTimeoutRef = useRef(null);\n  const [lastRequestTime, setLastRequestTime] = useState(0);\n  const MIN_REQUEST_INTERVAL = 2000; // Minimum 2 seconds between requests\n  const [currentTool, setCurrentTool] = useState('pencil'); // 'pencil', 'pen', 'eraser', 'text', 'rect', 'circle', 'line', 'star'\n  const [isTyping, setIsTyping] = useState(false);\n  const [undoStack, setUndoStack] = useState([]);\n  const [bezierPoints, setBezierPoints] = useState([]);\n  const [textInput, setTextInput] = useState('');\n  const [textPosition, setTextPosition] = useState({ x: 0, y: 0 });\n  const textInputRef = useRef(null);\n  const [isPenDrawing, setIsPenDrawing] = useState(false);\n  const [currentBezierPath, setCurrentBezierPath] = useState([]);\n  const [tempPoints, setTempPoints] = useState([]);\n  const [hasGeneratedContent, setHasGeneratedContent] = useState(false);\n  const [imageHistory, setImageHistory] = useState([]);\n  const [isHistoryModalOpen, setIsHistoryModalOpen] = useState(false);\n  const [hasDrawing, setHasDrawing] = useState(false);\n\n  // Load background image when generatedImage changes\n  useEffect(() => {\n    if (generatedImage && canvasRef.current) {\n      // Use the window.Image constructor to avoid conflict with Next.js Image component\n      const img = new window.Image();\n      img.onload = () => {\n        backgroundImageRef.current = img;\n        drawImageToCanvas(canvasRef.current, backgroundImageRef.current);\n      };\n      img.src = generatedImage;\n    }\n  }, [generatedImage]);\n\n  // Initialize canvas with white background when component mounts\n  useEffect(() => {\n    if (canvasRef.current) {\n      initializeCanvas(canvasRef.current);\n    }\n    \n    // Also initialize the display canvas\n    if (displayCanvasRef.current) {\n      const displayCtx = displayCanvasRef.current.getContext('2d');\n      displayCtx.fillStyle = '#FFFFFF';\n      displayCtx.fillRect(0, 0, displayCanvasRef.current.width, displayCanvasRef.current.height);\n    }\n  }, []);\n\n  // Add an effect to sync canvas dimensions when they change\n  useEffect(() => {\n    if (canvasRef.current && displayCanvasRef.current) {\n      // Ensure both canvases have the same dimensions\n      canvasRef.current.width = currentDimension.width;\n      canvasRef.current.height = currentDimension.height;\n      displayCanvasRef.current.width = currentDimension.width;\n      displayCanvasRef.current.height = currentDimension.height;\n      \n      // Initialize both canvases with white backgrounds\n      initializeCanvas(canvasRef.current);\n      \n      const displayCtx = displayCanvasRef.current.getContext('2d');\n      displayCtx.fillStyle = '#FFFFFF';\n      displayCtx.fillRect(0, 0, displayCanvasRef.current.width, displayCanvasRef.current.height);\n    }\n  }, [currentDimension]);\n\n  const startDrawing = (e) => {\n    const { x, y } = getCoordinates(e, canvasRef.current);\n    \n    if (e.type === 'touchstart') {\n      e.preventDefault();\n    }\n    \n    console.log('startDrawing called', { currentTool, x, y });\n    \n    const ctx = canvasRef.current.getContext(\"2d\");\n    \n    // Set up the line style at the start of drawing\n    ctx.lineWidth = currentTool === 'eraser' ? 20 : penWidth;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n    ctx.strokeStyle = currentTool === 'eraser' ? '#FFFFFF' : penColor;\n    \n    ctx.beginPath();\n    ctx.moveTo(x, y);\n    setIsDrawing(true);\n    setStrokeCount(prev => prev + 1);\n    \n    // Save canvas state before drawing\n    saveCanvasState();\n  };\n\n  const draw = (e) => {\n    if (!isDrawing) return;\n    \n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    const { x, y } = getCoordinates(e, canvas);\n    \n    // Occasionally log drawing activity\n    if (Math.random() < 0.05) { // Only log ~5% of move events to avoid console spam\n      console.log('draw called', { currentTool, isDrawing, x, y });\n    }\n    \n    // Set up the line style before drawing\n    ctx.lineWidth = currentTool === 'eraser' ? 60 : (penWidth * 4); // Pen width now 4x original size\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n    \n    if (currentTool === 'eraser') {\n      ctx.strokeStyle = '#FFFFFF';\n    } else {\n      ctx.strokeStyle = penColor;\n    }\n    \n    if (currentTool === 'pen') {\n      // Show preview line while moving\n      if (tempPoints.length > 0) {\n        const lastPoint = tempPoints[tempPoints.length - 1];\n        ctx.beginPath();\n        ctx.moveTo(lastPoint.x, lastPoint.y);\n        ctx.lineTo(x, y);\n        ctx.stroke();\n      }\n    } else {\n      ctx.lineTo(x, y);\n      ctx.stroke();\n    }\n  };\n\n  const stopDrawing = async (e) => {\n    console.log('stopDrawing called in CanvasContainer', { \n      isDrawing, \n      currentTool, \n      hasEvent: !!e,\n      eventType: e ? e.type : 'none'\n    });\n    \n    if (!isDrawing) return;\n    setIsDrawing(false);\n    \n    // Remove the timeout-based generation\n    if (strokeTimeoutRef.current) {\n      clearTimeout(strokeTimeoutRef.current);\n      strokeTimeoutRef.current = null;\n    }\n\n    // The Canvas component will handle generation for pen and pencil tools directly\n    // This function now primarily handles stroke counting for other tools\n    \n    // Only generate on mouse/touch up events when not using the pen or pencil tool\n    // (since those are handled by the Canvas component)\n    if (e && (e.type === 'mouseup' || e.type === 'touchend') && \n        currentTool !== 'pen' && currentTool !== 'pencil') {\n      console.log('stopDrawing: detected mouseup/touchend event', { strokeCount });\n      // Check if we have enough strokes to generate (increased to 10 from 3)\n      if (strokeCount >= 10) {\n        console.log('stopDrawing: calling handleGeneration due to stroke count');\n        await handleGeneration();\n        setStrokeCount(0);\n      }\n    }\n  };\n\n  const clearCanvas = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    initializeCanvas(canvas);\n    \n    setGeneratedImage(null);\n    backgroundImageRef.current = null;\n    \n    // Also clear the display canvas and reset generated content flag\n    if (displayCanvasRef.current) {\n      const displayCtx = displayCanvasRef.current.getContext('2d');\n      displayCtx.clearRect(0, 0, displayCanvasRef.current.width, displayCanvasRef.current.height);\n      displayCtx.fillStyle = '#FFFFFF';\n      displayCtx.fillRect(0, 0, displayCanvasRef.current.width, displayCanvasRef.current.height);\n      setHasGeneratedContent(false);\n    }\n    \n    // Save empty canvas state\n    saveCanvasState();\n  };\n\n  const handleGeneration = useCallback(async () => {\n    console.log('handleGeneration called');\n    \n    const now = Date.now();\n    if (now - lastRequestTime < MIN_REQUEST_INTERVAL) {\n      console.log(\"Request throttled - too soon after last request\");\n      return;\n    }\n    \n    setLastRequestTime(now);\n    if (!canvasRef.current) return;\n    \n    console.log('Starting generation process');\n    \n    // Check if we're already in a loading state before setting it\n    if (!isLoading) {\n      setIsLoading(true);\n    }\n    \n    try {\n      const canvas = canvasRef.current;\n      const tempCanvas = document.createElement('canvas');\n      tempCanvas.width = canvas.width;\n      tempCanvas.height = canvas.height;\n      const tempCtx = tempCanvas.getContext('2d');\n      \n      tempCtx.fillStyle = '#FFFFFF';\n      tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);\n      tempCtx.drawImage(canvas, 0, 0);\n      \n      const drawingData = tempCanvas.toDataURL(\"image/png\").split(\",\")[1];\n      \n      const materialPrompt = getPromptForStyle(styleMode);\n      \n      const requestPayload = {\n        prompt: materialPrompt,\n        drawingData,\n        customApiKey\n      };\n      \n      console.log('Making API request with style:', styleMode);\n      console.log('Using prompt:', materialPrompt.substring(0, 100) + '...');\n      \n      const response = await fetch(\"/api/generate\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(requestPayload),\n      });\n      \n      console.log('API response received, status:', response.status);\n      \n      const data = await response.json();\n      \n      if (data.success && data.imageData) {\n        console.log('Image generated successfully');\n        const imageUrl = `data:image/png;base64,${data.imageData}`;\n        \n        // Draw the generated image to the display canvas\n        const displayCanvas = displayCanvasRef.current;\n        if (!displayCanvas) {\n          console.error('Display canvas ref is null');\n          return;\n        }\n        \n        const displayCtx = displayCanvas.getContext('2d');\n        \n        // Clear the display canvas first\n        displayCtx.clearRect(0, 0, displayCanvas.width, displayCanvas.height);\n        displayCtx.fillStyle = '#FFFFFF';\n        displayCtx.fillRect(0, 0, displayCanvas.width, displayCanvas.height);\n        \n        // Create and load the new image\n        const img = new Image();\n        \n        // Set up the onload handler before setting the src\n        img.onload = () => {\n          console.log('Generated image loaded, drawing to display canvas');\n          displayCtx.clearRect(0, 0, displayCanvas.width, displayCanvas.height);\n          displayCtx.drawImage(img, 0, 0, displayCanvas.width, displayCanvas.height);\n          console.log('Image drawn to display canvas');\n          \n          // Update our state to indicate we have generated content\n          setHasGeneratedContent(true);\n\n          // Add to history\n          setImageHistory(prev => [...prev, {\n            imageUrl,\n            timestamp: Date.now(),\n            drawingData: canvas.toDataURL(),\n            styleMode,\n            dimensions: currentDimension\n          }]);\n        };\n        \n        // Set the src to trigger loading\n        img.src = imageUrl;\n      } else {\n        console.error(\"Failed to generate image:\", data.error);\n        \n        // When generation fails, ensure display canvas is cleared\n        if (displayCanvasRef.current) {\n          const displayCtx = displayCanvasRef.current.getContext('2d');\n          displayCtx.clearRect(0, 0, displayCanvasRef.current.width, displayCanvasRef.current.height);\n          displayCtx.fillStyle = '#FFFFFF';\n          displayCtx.fillRect(0, 0, displayCanvasRef.current.width, displayCanvasRef.current.height);\n        }\n        \n        // Make sure we mark that we don't have generated content\n        setHasGeneratedContent(false);\n        \n        if (data.error && (\n          data.error.includes(\"Resource has been exhausted\") || \n          data.error.includes(\"quota\") ||\n          response.status === 429 ||\n          response.status === 500\n        )) {\n          setErrorMessage(data.error);\n          setShowErrorModal(true);\n        }\n      }\n    } catch (error) {\n      console.error(\"Error generating image:\", error);\n      setErrorMessage(error.message || \"An unexpected error occurred.\");\n      setShowErrorModal(true);\n      \n      // When generation errors, ensure display canvas is cleared\n      if (displayCanvasRef.current) {\n        const displayCtx = displayCanvasRef.current.getContext('2d');\n        displayCtx.clearRect(0, 0, displayCanvasRef.current.width, displayCanvasRef.current.height);\n        displayCtx.fillStyle = '#FFFFFF';\n        displayCtx.fillRect(0, 0, displayCanvasRef.current.width, displayCanvasRef.current.height);\n      }\n      \n      // Make sure we mark that we don't have generated content\n      setHasGeneratedContent(false);\n    } finally {\n      setIsLoading(false);\n      console.log('Generation process completed');\n    }\n  }, [\n    lastRequestTime, \n    styleMode, \n    customApiKey,\n    currentDimension\n  ]);\n\n  // Close the error modal\n  const closeErrorModal = () => {\n    setShowErrorModal(false);\n  };\n\n  // Handle the custom API key submission\n  const handleApiKeySubmit = (e) => {\n    e.preventDefault();\n    setShowErrorModal(false);\n    // Will use the customApiKey state in the next API call\n  };\n\n  // Add this function to handle undo\n  const handleUndo = () => {\n    if (undoStack.length > 0) {\n      const canvas = canvasRef.current;\n      const ctx = canvas.getContext('2d');\n      const previousState = undoStack[undoStack.length - 2]; // Get second to last state\n      \n      if (previousState) {\n        const img = new Image();\n        img.onload = () => {\n          ctx.fillStyle = '#FFFFFF';\n          ctx.fillRect(0, 0, canvas.width, canvas.height);\n          ctx.drawImage(img, 0, 0);\n        };\n        img.src = previousState;\n      } else {\n        // If no previous state, clear to white\n        ctx.fillStyle = '#FFFFFF';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n      }\n      \n      setUndoStack(prev => prev.slice(0, -1));\n    }\n  };\n\n  // Add this function to save canvas state\n  const saveCanvasState = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    const dataURL = canvas.toDataURL();\n    setUndoStack(prev => [...prev, dataURL]);\n  };\n\n  // Add this function to handle text input\n  const handleTextInput = (e) => {\n    if (e.key === 'Enter') {\n      const canvas = canvasRef.current;\n      const ctx = canvas.getContext('2d');\n      ctx.font = '24px Arial';\n      ctx.fillStyle = '#000000';\n      ctx.fillText(textInput, textPosition.x, textPosition.y);\n      setTextInput('');\n      setIsTyping(false);\n      saveCanvasState();\n    }\n  };\n\n  // Modify the canvas click handler to handle text placement\n  const handleCanvasClick = (e) => {\n    if (currentTool === 'text') {\n      const { x, y } = getCoordinates(e, canvasRef.current);\n      setTextPosition({ x, y });\n      setIsTyping(true);\n      if (textInputRef.current) {\n        textInputRef.current.focus();\n      }\n    }\n  };\n\n  // Handle pen click for bezier curve tool\n  const handlePenClick = (e) => {\n    if (currentTool !== 'pen') return;\n    \n    // Note: Actual point creation is now handled in the Canvas component\n    // This function is primarily used as a callback to inform the CanvasContainer\n    // that a pen action happened\n    \n    console.log('handlePenClick called in CanvasContainer');\n    \n    // Set isDrawing flag to true when using pen tool\n    // This ensures handleStopDrawing knows we're in drawing mode with the pen\n    setIsDrawing(true);\n    \n    // Save canvas state when adding new points\n    saveCanvasState();\n  };\n\n  // Add this new function near your other utility functions\n  const handleSaveImage = () => {\n    // For the generated image\n    if (displayCanvasRef.current) {\n      const link = document.createElement('a');\n      link.download = 'chrome-study.png';\n      link.href = displayCanvasRef.current.toDataURL('image/png');\n      link.click();\n    }\n  };\n\n  // Add this function to handle regeneration\n  const handleRegenerate = async () => {\n    if (canvasRef.current) {\n      // Temporarily reset hasGeneratedContent so placeholder shows during loading\n      setHasGeneratedContent(false);\n      await handleGeneration();\n    }\n  };\n\n  // Add useEffect to watch for styleMode changes and regenerate\n  useEffect(() => {\n    // Only trigger if we have something drawn (check if canvas is not empty)\n    const checkCanvasAndGenerate = async () => {\n      if (!canvasRef.current) return;\n      \n      const canvas = canvasRef.current;\n      const ctx = canvas.getContext('2d');\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      \n      // Check if canvas has any non-white pixels\n      const hasDrawing = Array.from(imageData.data).some((pixel, index) => {\n        // Check only RGB values (skip alpha)\n        return index % 4 !== 3 && pixel !== 255;\n      });\n\n      if (hasDrawing) {\n        await handleGeneration();\n      }\n    };\n\n    // Skip on first render\n    if (styleMode) {\n      checkCanvasAndGenerate();\n    }\n  }, [styleMode, handleGeneration]); // Added handleGeneration to dependency array\n\n  // Cleanup function - keep this to prevent memory leaks\n  useEffect(() => {\n    return () => {\n      if (strokeTimeoutRef.current) {\n        clearTimeout(strokeTimeoutRef.current);\n        strokeTimeoutRef.current = null;\n      }\n    };\n  }, []);\n\n  // Handle dimension change\n  const handleDimensionChange = (newDimension) => {\n    console.log('Changing dimensions to:', newDimension);\n    \n    // Clear both canvases\n    if (canvasRef.current) {\n      const canvas = canvasRef.current;\n      canvas.width = newDimension.width;\n      canvas.height = newDimension.height;\n      initializeCanvas(canvas);\n    }\n    \n    if (displayCanvasRef.current) {\n      const displayCanvas = displayCanvasRef.current;\n      displayCanvas.width = newDimension.width;\n      displayCanvas.height = newDimension.height;\n      const ctx = displayCanvas.getContext('2d');\n      ctx.fillStyle = '#FFFFFF';\n      ctx.fillRect(0, 0, displayCanvas.width, displayCanvas.height);\n    }\n    \n    // Reset generation state\n    setHasGeneratedContent(false);\n    setGeneratedImage(null);\n    backgroundImageRef.current = null;\n    \n    // Update dimension state AFTER canvas dimensions are updated\n    setCurrentDimension(newDimension);\n  };\n\n  // Add new function to handle selecting a historical image\n  const handleSelectHistoricalImage = (historyItem) => {\n    // Set the current dimension to match the historical image\n    if (historyItem.dimensions) {\n      setCurrentDimension(historyItem.dimensions);\n    }\n\n    // Draw the original drawing to the canvas\n    const drawingImg = new Image();\n    drawingImg.onload = () => {\n      const canvas = canvasRef.current;\n      if (canvas) {\n        const ctx = canvas.getContext('2d');\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        ctx.drawImage(drawingImg, 0, 0, canvas.width, canvas.height);\n      }\n    };\n    drawingImg.src = historyItem.drawingData;\n\n    // Draw the generated image to the display canvas\n    const generatedImg = new Image();\n    generatedImg.onload = () => {\n      const displayCanvas = displayCanvasRef.current;\n      if (displayCanvas) {\n        const ctx = displayCanvas.getContext('2d');\n        ctx.clearRect(0, 0, displayCanvas.width, displayCanvas.height);\n        ctx.drawImage(generatedImg, 0, 0, displayCanvas.width, displayCanvas.height);\n        setHasGeneratedContent(true);\n      }\n    };\n    generatedImg.src = historyItem.imageUrl;\n\n    // Close the history modal\n    setIsHistoryModalOpen(false);\n  };\n\n  // Add new function to handle image refinement\n  const handleImageRefinement = async (refinementPrompt) => {\n    if (!displayCanvasRef.current || !hasGeneratedContent) return;\n    \n    console.log('Starting image refinement with prompt:', refinementPrompt);\n    setIsLoading(true);\n    \n    try {\n      // Get the current image data\n      const displayCanvas = displayCanvasRef.current;\n      const imageData = displayCanvas.toDataURL(\"image/png\").split(\",\")[1];\n      \n      const requestPayload = {\n        prompt: refinementPrompt,\n        imageData,\n        customApiKey\n      };\n      \n      console.log('Making refinement API request');\n      \n      const response = await fetch(\"/api/refine\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(requestPayload),\n      });\n      \n      console.log('Refinement API response received, status:', response.status);\n      \n      const data = await response.json();\n      \n      if (data.success && data.imageData) {\n        console.log('Image refined successfully');\n        const imageUrl = `data:image/png;base64,${data.imageData}`;\n        \n        // Draw the refined image to the display canvas\n        const displayCtx = displayCanvas.getContext('2d');\n        const img = new Image();\n        \n        img.onload = () => {\n          console.log('Refined image loaded, drawing to display canvas');\n          displayCtx.clearRect(0, 0, displayCanvas.width, displayCanvas.height);\n          displayCtx.drawImage(img, 0, 0, displayCanvas.width, displayCanvas.height);\n          \n          // Add to history\n          setImageHistory(prev => [...prev, {\n            imageUrl,\n            timestamp: Date.now(),\n            drawingData: canvasRef.current.toDataURL(),\n            styleMode,\n            dimensions: currentDimension\n          }]);\n        };\n        \n        img.src = imageUrl;\n      } else {\n        console.error(\"Failed to refine image:\", data.error);\n        setErrorMessage(data.error || \"Failed to refine image. Please try again.\");\n        setShowErrorModal(true);\n      }\n    } catch (error) {\n      console.error('Error during refinement:', error);\n      setErrorMessage(\"An error occurred during refinement. Please try again.\");\n      setShowErrorModal(true);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Add onImageUpload function\n  const handleImageUpload = (imageDataUrl) => {\n    if (!canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    const img = new Image();\n    \n    img.onload = () => {\n      // Clear the canvas\n      ctx.fillStyle = '#FFFFFF';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      \n      // Calculate dimensions to maintain aspect ratio and fit within canvas\n      const scale = Math.min(\n        canvas.width / img.width,\n        canvas.height / img.height\n      );\n      const x = (canvas.width - img.width * scale) / 2;\n      const y = (canvas.height - img.height * scale) / 2;\n\n      // Draw the image centered and scaled\n      ctx.drawImage(\n        img,\n        x, y,\n        img.width * scale,\n        img.height * scale\n      );\n\n      // Save canvas state after uploading image\n      saveCanvasState();\n      setHasGeneratedContent(true);\n    };\n\n    img.src = imageDataUrl;\n  };\n\n  // Add stroke width handler\n  const handleStrokeWidth = (width) => {\n    setPenWidth(width);\n  };\n\n  return (\n    <div className=\"flex min-h-screen flex-col items-center justify-start bg-gray-50 p-2 md:p-4\">\n      <div className=\"w-full max-w-[1800px] mx-auto pb-32\">\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between gap-4\">\n            <div className=\"flex-shrink-0\">\n              <Header />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <GalleryButton />\n              <DimensionSelector \n                currentDimension={currentDimension}\n                onDimensionChange={handleDimensionChange}\n              />\n              <a \n                href=\"https://aistudio.google.com/prompts/new_chat\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"text-sm text-gray-600 border border-gray-200 px-4 py-2 rounded-full whitespace-nowrap opacity-70 hover:opacity-100 hover:bg-gray-50 hover:border-gray-300 transition-all\"\n              >\n                Using Gemini 2.0 Native Image Generation\n              </a>\n            </div>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 items-stretch\">\n            <div className=\"flex flex-col items-center gap-4\">\n              <div className=\"flex justify-center w-full h-full\">\n                <Canvas \n                  canvasRef={canvasRef}\n                  currentTool={currentTool}\n                  isDrawing={isDrawing}\n                  startDrawing={startDrawing}\n                  draw={draw}\n                  stopDrawing={stopDrawing}\n                  handleCanvasClick={handleCanvasClick}\n                  handlePenClick={handlePenClick}\n                  handleGeneration={handleGeneration}\n                  tempPoints={tempPoints}\n                  setTempPoints={setTempPoints}\n                  handleUndo={handleUndo}\n                  clearCanvas={clearCanvas}\n                  setCurrentTool={setCurrentTool}\n                  currentDimension={currentDimension}\n                  currentColor={penColor}\n                  currentWidth={penWidth}\n                  onImageUpload={handleImageUpload}\n                  onGenerate={handleGeneration}\n                  isGenerating={isLoading}\n                  setIsGenerating={setIsLoading}\n                  saveCanvasState={saveCanvasState}\n                  onDrawingChange={setHasDrawing}\n                />\n              </div>\n              <div className=\"flex justify-center w-full h-full\">\n                <div className=\"flex w-full\">\n                  <div className=\"flex-shrink-0 w-[54px] mr-4\">\n                    <BottomToolBar />\n                  </div>\n                  <div \n                    className=\"flex-1 rounded-xl\"\n                    style={{\n                      aspectRatio: `${currentDimension.width} / ${currentDimension.height}`,\n                      maxWidth: '100%',\n                      maxHeight: '800px',\n                      position: 'relative',\n                      overflow: 'hidden'\n                    }}\n                  >\n                    <div className=\"absolute inset-0 flex items-start justify-start\">\n                      <StyleSelector \n                        styleMode={styleMode}\n                        setStyleMode={setStyleMode}\n                        handleGenerate={handleGeneration}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex flex-col items-center\">\n              <div className=\"flex justify-center w-full h-full\">\n                <DisplayCanvas \n                  displayCanvasRef={displayCanvasRef}\n                  isLoading={isLoading}\n                  handleSaveImage={handleSaveImage}\n                  handleRegenerate={handleRegenerate}\n                  hasGeneratedContent={hasGeneratedContent}\n                  currentDimension={currentDimension}\n                  onOpenHistory={() => setIsHistoryModalOpen(true)}\n                  onRefineImage={handleImageRefinement}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <ErrorModal \n        showErrorModal={showErrorModal}\n        closeErrorModal={closeErrorModal}\n        customApiKey={customApiKey}\n        setCustomApiKey={setCustomApiKey}\n        handleApiKeySubmit={handleApiKeySubmit}\n      />\n\n      <TextInput \n        isTyping={isTyping}\n        textInputRef={textInputRef}\n        textInput={textInput}\n        setTextInput={setTextInput}\n        handleTextInput={handleTextInput}\n        textPosition={textPosition}\n      />\n\n      <HistoryModal\n        isOpen={isHistoryModalOpen}\n        onClose={() => setIsHistoryModalOpen(false)}\n        history={imageHistory}\n        onSelectImage={handleSelectHistoricalImage}\n        currentDimension={currentDimension}\n      />\n    </div>\n  );\n};\n\nexport default CanvasContainer; "],"names":[],"mappings":"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","debugId":null}}]
}